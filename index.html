<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StarCadet: Space Academy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <!-- Three.js for 3D Simulation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <link
        href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Rajdhani:wght@300;400;500;600;700&family=Teko:wght@300;400;500;600;700&family=Noto+Sans+Devanagari:wght@400;700&display=swap"
        rel="stylesheet">

    <style>
        /* Custom Space Styles */
        :root {
            --space-black: #050b14;
            --space-blue: #0f172a;
            --neon-cyan: #22d3ee;
            --neon-purple: #a855f7;
            --neon-gold: #fbbf24;
            --glass-bg: rgba(15, 23, 42, 0.85);
            --glass-border: rgba(34, 211, 238, 0.2);
        }

        body {
            background-color: var(--space-black);
            font-family: 'Rajdhani', 'Noto Sans Devanagari', sans-serif;
            color: white;
            overflow-x: hidden;
            cursor: none;
        }

        /* Custom Cursor */
        #cursor-dot,
        #cursor-ring {
            position: fixed;
            top: 0;
            left: 0;
            pointer-events: none;
            z-index: 9999;
            transform: translate(-50%, -50%);
            border-radius: 50%;
        }

        #cursor-dot {
            width: 8px;
            height: 8px;
            background: var(--neon-cyan);
            box-shadow: 0 0 10px var(--neon-cyan);
        }

        #cursor-ring {
            width: 40px;
            height: 40px;
            border: 1px solid rgba(34, 211, 238, 0.5);
            transition: width 0.2s, height 0.2s, background-color 0.2s;
        }

        body.hovering #cursor-ring {
            width: 60px;
            height: 60px;
            background-color: rgba(34, 211, 238, 0.1);
            border-color: var(--neon-cyan);
        }

        /* Sci-Fi Headers */
        h1,
        h2,
        h3,
        h4,
        .orbitron {
            font-family: 'Orbitron', 'Teko', sans-serif;
            letter-spacing: 0.05em;
        }

        .lang-hi h1,
        .lang-hi h2,
        .lang-hi h3 {
            font-family: 'Teko', sans-serif;
            font-weight: 500;
            letter-spacing: 0.02em;
        }

        .lang-hi p,
        .lang-hi button {
            font-family: 'Noto Sans Devanagari', sans-serif;
        }

        /* Cyber Grid Overlay */
        .cyber-grid {
            position: fixed;
            top: 0;
            left: 0;
            width: 200vw;
            height: 200vh;
            background:
                linear-gradient(rgba(34, 211, 238, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(34, 211, 238, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            pointer-events: none;
            z-index: -1;
            transform: perspective(500px) rotateX(60deg) translateY(-100px) translateZ(-200px);
            animation: grid-move 20s linear infinite;
        }

        @keyframes grid-move {
            0% {
                transform: perspective(500px) rotateX(60deg) translateY(0) translateZ(-200px);
            }

            100% {
                transform: perspective(500px) rotateX(60deg) translateY(50px) translateZ(-200px);
            }
        }

        #star-canvas {
            position: fixed;
            top: 0;
            left: 0;
            z-index: -2;
            pointer-events: none;
        }

        .glass-panel {
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            box-shadow: 0 0 15px rgba(34, 211, 238, 0.1), inset 0 0 20px rgba(0, 0, 0, 0.5);
            position: relative;
            overflow: hidden;
        }

        .glass-panel::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, transparent, rgba(34, 211, 238, 0.05), transparent);
            transform: translateY(-100%);
            animation: scanline 4s linear infinite;
            pointer-events: none;
        }

        @keyframes scanline {
            0% {
                transform: translateY(-100%);
            }

            100% {
                transform: translateY(100%);
            }
        }

        .stagger-item {
            opacity: 0;
            transform: translateY(20px);
            animation: stagger-slide-up 0.5s forwards ease-out;
        }

        @keyframes stagger-slide-up {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .clip-corners {
            clip-path: polygon(10px 0, 100% 0, 100% calc(100% - 10px), calc(100% - 10px) 100%, 0 100%, 0 10px);
        }

        .neon-text-cyan {
            text-shadow: 0 0 10px rgba(34, 211, 238, 0.8);
        }

        .neon-text-purple {
            text-shadow: 0 0 10px rgba(168, 85, 247, 0.8);
        }

        @keyframes pulse-glow {
            0% {
                box-shadow: 0 0 0 0 rgba(34, 211, 238, 0.4);
            }

            70% {
                box-shadow: 0 0 0 10px rgba(34, 211, 238, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(34, 211, 238, 0);
            }
        }

        .animate-pulse-glow {
            animation: pulse-glow 2s infinite;
        }

        @keyframes float {
            0% {
                transform: translateY(0px);
            }

            50% {
                transform: translateY(-10px);
            }

            100% {
                transform: translateY(0px);
            }
        }

        .animate-float {
            animation: float 4s ease-in-out infinite;
        }

        .fade-enter {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.5s ease, transform 0.5s ease;
        }

        .fade-enter-active {
            opacity: 1;
            transform: translateY(0);
        }

        #warp-overlay {
            position: fixed;
            inset: 0;
            background: black;
            z-index: 200;
            display: none;
            opacity: 0;
            transition: opacity 0.5s;
        }

        #warp-overlay.active {
            display: flex;
            opacity: 1;
        }

        .lang-switch {
            position: relative;
            display: inline-flex;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid var(--neon-cyan);
            border-radius: 4px;
            overflow: hidden;
            cursor: pointer;
        }

        .lang-option {
            padding: 4px 12px;
            font-size: 0.8rem;
            font-weight: bold;
            transition: all 0.3s;
        }

        .lang-option.active {
            background: var(--neon-cyan);
            color: black;
            box-shadow: 0 0 10px var(--neon-cyan);
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #0f172a;
        }

        ::-webkit-scrollbar-thumb {
            background: #334155;
            border-radius: 4px;
            border: 1px solid var(--neon-cyan);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #22d3ee;
        }

        .planet-visual {
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, #4f46e5, #0f172a);
            box-shadow: inset -10px -10px 20px rgba(0, 0, 0, 0.8), 0 0 20px rgba(79, 70, 229, 0.5);
            transition: transform 0.5s ease;
        }

        .planet-visual:hover {
            transform: scale(1.05) rotate(5deg);
        }

        .hidden-section {
            display: none;
        }

        /* 3D View Specifics */
        #solar-canvas {
            width: 100%;
            height: 100%;
            display: block;
        }

        .holo-overlay {
            pointer-events: none;
        }

        .holo-overlay>* {
            pointer-events: auto;
        }
    </style>
</head>

<body class="antialiased min-h-screen flex flex-col">

    <!-- Custom Cursor -->
    <div id="cursor-dot"></div>
    <div id="cursor-ring"></div>

    <!-- Backgrounds -->
    <canvas id="star-canvas"></canvas>
    <div class="cyber-grid"></div>

    <!-- Warp Animation Overlay -->
    <div id="warp-overlay" class="items-center justify-center flex-col">
        <div class="text-cyan-400 text-3xl orbitron tracking-widest animate-pulse mb-4" id="warp-text">INITIATING WARP
            DRIVE...</div>
        <div class="w-64 h-2 bg-slate-800 rounded-full overflow-hidden border border-cyan-900">
            <div class="h-full bg-cyan-400 w-full animate-pulse shadow-[0_0_10px_#22d3ee]"></div>
        </div>
    </div>

    <!-- Rank Up Modal -->
    <div id="rank-modal"
        class="fixed inset-0 z-[300] bg-black/95 backdrop-blur-xl hidden flex items-center justify-center p-4">
        <div class="text-center animate-float">
            <div class="relative mb-8 inline-block">
                <div class="absolute inset-0 animate-ping opacity-30 rounded-full bg-yellow-400"></div>
                <div class="absolute inset-0 animate-pulse opacity-50 rounded-full bg-yellow-400 blur-xl"></div>
                <i
                    class="ph-fill ph-medal-military text-9xl text-yellow-400 relative z-10 drop-shadow-[0_0_30px_rgba(250,204,21,0.8)]"></i>
            </div>
            <h2
                class="text-5xl md:text-7xl font-black text-white mb-2 orbitron tracking-widest uppercase neon-text-gold">
                PROMOTION</h2>
            <p class="text-gray-400 text-xl mb-8 font-mono tracking-widest" id="rank-modal-subtitle">NEW RANK ASSIGNED
            </p>
            <div class="text-3xl md:text-5xl font-bold text-yellow-400 mb-10 border-y-2 border-yellow-400/30 py-6 bg-yellow-400/5 orbitron"
                id="new-rank-name">STAR VOYAGER</div>
            <button onclick="app.closeRankModal()"
                class="px-10 py-4 bg-yellow-500 hover:bg-yellow-400 text-black font-bold text-xl clip-corners transition-all shadow-[0_0_20px_rgba(234,179,8,0.5)] flex items-center gap-2 mx-auto"><i
                    class="ph-bold ph-check"></i> ACKNOWLEDGE</button>
        </div>
    </div>

    <!-- Navigation Bar -->
    <nav class="fixed top-0 w-full z-50 glass-panel border-b border-cyan-500/30 px-6 py-4">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-3 cursor-pointer group" onclick="app.goHome()">
                <i
                    class="ph-fill ph-rocket-launch text-3xl text-cyan-400 group-hover:-translate-y-1 transition-transform drop-shadow-[0_0_5px_rgba(34,211,238,0.8)]"></i>
                <div class="flex flex-col">
                    <span class="orbitron font-bold text-xl tracking-wider text-white neon-text-cyan">STAR<span
                            class="text-cyan-400">CADET</span></span>
                    <span class="text-xs text-gray-400 tracking-widest uppercase" id="nav-subtitle">Space Academy</span>
                </div>
            </div>

            <div class="flex items-center gap-6">
                <!-- 3D View Button -->
                <button onclick="app.launchHoloDeck()"
                    class="hidden md:flex items-center gap-2 px-4 py-2 bg-blue-600/20 border border-blue-500 text-blue-300 rounded hover:bg-blue-500 hover:text-white transition-all clip-corners">
                    <i class="ph-bold ph-cube text-lg"></i>
                    <span class="font-mono font-bold tracking-widest">HOLO-DECK</span>
                </button>

                <!-- Language Toggle -->
                <div class="lang-switch" onclick="app.toggleLanguage()">
                    <div class="lang-option active" id="btn-en">EN</div>
                    <div class="lang-option" id="btn-hi">HI</div>
                </div>

                <button onclick="app.resetProgress()" id="btn-reset"
                    class="hidden md:block text-xs text-red-400 hover:text-red-300 uppercase tracking-wider border border-red-500/30 px-3 py-1 rounded bg-red-900/10 hover:bg-red-900/30 transition-colors">Reset
                    Data</button>

                <div class="flex flex-col items-end">
                    <span class="text-xs text-gray-400 uppercase" id="label-rank">Current Rank</span>
                    <span id="rank-display" class="font-bold font-mono transition-colors duration-500">Rookie
                        Cadet</span>
                </div>

                <div id="profile-container"
                    class="w-12 h-12 rounded-full bg-slate-800 border-2 flex items-center justify-center relative overflow-hidden transition-all duration-500">
                    <i class="ph-fill ph-user-astronaut text-2xl text-white relative z-10"></i>
                    <div id="profile-glow" class="absolute inset-0 opacity-50 blur-md"></div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content Area -->
    <main id="main-container" class="flex-grow pt-24 px-4 pb-12 relative z-10">

        <!-- View: Intro / Landing -->
        <section id="intro-view"
            class="h-[80vh] flex flex-col items-center justify-center text-center fade-enter-active relative">
            <div class="mb-8 relative group animate-float z-10">
                <div
                    class="absolute -inset-1 bg-gradient-to-r from-cyan-400 to-purple-600 rounded-full blur opacity-25 group-hover:opacity-75 transition duration-1000 group-hover:duration-200">
                </div>
                <div
                    class="relative w-48 h-48 md:w-64 md:h-64 rounded-full bg-black flex items-center justify-center planet-visual border-4 border-slate-800/80 backdrop-blur-sm">
                    <i class="ph-duotone ph-planet text-8xl text-white/90"></i>
                </div>
            </div>
            <h1 id="landing-title" class="text-5xl md:text-8xl font-black mb-4 tracking-tight neon-text-cyan z-10">
                EXPLORE THE COSMOS</h1>
            <p id="landing-subtitle"
                class="text-xl md:text-2xl text-gray-300 max-w-2xl mb-10 font-light z-10 drop-shadow-md">
                Your journey from Earth to the edge of the universe begins here. Complete missions, analyze data, and
                earn your wings.
            </p>
            <div class="flex gap-4 z-10">
                <button onclick="app.startJourney()" id="btn-start"
                    class="group relative px-8 py-4 bg-cyan-500/10 hover:bg-cyan-500/20 border border-cyan-400 text-cyan-300 font-bold text-xl rounded-none clip-corners transition-all shadow-[0_0_20px_rgba(34,211,238,0.2)] hover:shadow-[0_0_40px_rgba(34,211,238,0.5)] flex items-center gap-3 backdrop-blur-md">
                    <i class="ph-bold ph-paper-plane-tilt group-hover:translate-x-1 transition-transform"></i>
                    <span class="tracking-widest">START MISSION</span>
                </button>
                <button onclick="app.launchHoloDeck()"
                    class="group relative px-8 py-4 bg-blue-600/20 hover:bg-blue-600/40 border border-blue-500 text-blue-300 font-bold text-xl rounded-none clip-corners transition-all shadow-[0_0_20px_rgba(37,99,235,0.2)] flex items-center gap-3 backdrop-blur-md">
                    <i class="ph-bold ph-cube group-hover:rotate-12 transition-transform"></i>
                    <span class="tracking-widest">3D SYSTEM</span>
                </button>
            </div>
        </section>

        <!-- View: Mission Dashboard -->
        <section id="dashboard-view" class="hidden-section max-w-5xl mx-auto">
            <div class="text-center mb-16 relative stagger-item" style="animation-delay: 0ms">
                <div
                    class="absolute top-1/2 left-0 w-full h-px bg-gradient-to-r from-transparent via-cyan-900 to-transparent">
                </div>
                <h2 id="dashboard-title"
                    class="text-4xl font-bold mb-2 text-white bg-space-black inline-block px-6 relative z-10 neon-text-cyan">
                    MISSION CONTROL</h2>
                <p id="dashboard-subtitle" class="text-gray-400 mt-2">Select your destination. Complete missions
                    sequentially to unlock deeper space.</p>
            </div>

            <div class="relative py-10">
                <div
                    class="absolute left-1/2 top-0 bottom-0 w-0.5 bg-gradient-to-b from-transparent via-cyan-900 to-transparent -translate-x-1/2 hidden md:block">
                </div>
                <div id="mission-list" class="space-y-12 relative"></div>
            </div>
        </section>

        <!-- View: Mission Details -->
        <section id="mission-detail-view" class="hidden-section max-w-6xl mx-auto">
            <button onclick="app.showDashboard()" id="btn-back"
                class="mb-6 flex items-center gap-2 text-gray-400 hover:text-cyan-400 transition-colors group px-4 py-2 border border-transparent hover:border-cyan-500/30 rounded stagger-item"
                style="animation-delay: 0ms">
                <i class="ph-bold ph-caret-left group-hover:-translate-x-1 transition-transform"></i> Return to Star Map
            </button>
            <div id="mission-content-area"></div>
        </section>

        <!-- View: 3D Solar System (Holo-Deck) -->
        <section id="solar-system-view" class="hidden-section absolute inset-0 z-40 bg-black">
            <div class="absolute top-24 left-6 z-50 flex flex-col gap-4 holo-overlay">
                <button onclick="app.closeHoloDeck()"
                    class="flex items-center gap-2 text-white/70 hover:text-white bg-black/50 px-4 py-2 border border-white/20 rounded w-fit">
                    <i class="ph-bold ph-arrow-left"></i> Exit Holo-Deck
                </button>

                <!-- Tools -->
                <div class="bg-slate-900/80 border border-blue-500/30 p-4 rounded max-w-xs backdrop-blur-md">
                    <h3 class="text-blue-400 font-bold orbitron mb-2">TOOLS</h3>
                    <button id="btn-measure" onclick="solarApp.toggleMeasureMode()"
                        class="w-full text-left px-3 py-2 bg-black/40 hover:bg-blue-500/20 border border-white/10 rounded flex items-center justify-between group transition-colors mb-2">
                        <span class="text-sm font-mono text-gray-300 group-hover:text-white">VOID MEASURE</span>
                        <i class="ph-bold ph-ruler text-blue-400"></i>
                    </button>
                    <button onclick="solarApp.showCosmicIntel()"
                        class="w-full text-left px-3 py-2 bg-black/40 hover:bg-purple-500/20 border border-white/10 rounded flex items-center justify-between group transition-colors">
                        <span class="text-sm font-mono text-gray-300 group-hover:text-white">COSMIC INTEL</span>
                        <i class="ph-bold ph-book-open-text text-purple-400"></i>
                    </button>
                    <div id="measure-output"
                        class="hidden mt-3 pt-3 border-t border-white/10 text-xs font-mono text-cyan-300">
                        Select two planets...
                    </div>
                </div>

                <!-- Info Panel -->
                <div id="planet-info-panel"
                    class="hidden bg-slate-900/90 border-l-4 border-cyan-500 p-6 rounded max-w-sm backdrop-blur-md stagger-item shadow-2xl">
                    <button onclick="solarApp.closeInfoPanel()" class="float-right text-gray-500 hover:text-white"><i
                            class="ph-bold ph-x"></i></button>
                    <h2 id="p3d-name" class="text-3xl font-bold text-white orbitron mb-1">EARTH</h2>
                    <p id="p3d-type" class="text-xs text-cyan-400 uppercase tracking-widest mb-4">TERRESTRIAL PLANET</p>

                    <div class="space-y-3">
                        <p id="p3d-desc" class="text-sm text-gray-300 leading-relaxed border-l-2 border-white/10 pl-3">A
                            standard terrestrial world.</p>

                        <div class="grid grid-cols-2 gap-2 text-xs font-mono text-gray-400" id="p3d-stats">
                            <!-- Stats injected here -->
                        </div>

                        <div class="bg-black/30 p-3 rounded border border-white/5">
                            <div class="text-xs text-yellow-500 uppercase font-bold mb-1">AMAZING FACT</div>
                            <p id="p3d-fact" class="text-xs text-white italic">Fact goes here.</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="absolute bottom-6 left-0 w-full text-center pointer-events-none z-50">
                <p class="text-white/30 font-mono text-xs">LEFT CLICK: ROTATE | SCROLL: ZOOM | CLICK PLANET: SCAN</p>
            </div>

            <!-- Canvas Container -->
            <div id="canvas-container" class="w-full h-full cursor-move"></div>
        </section>

        <!-- Cosmic Intel Modal -->
        <div id="intel-modal"
            class="fixed inset-0 z-[100] bg-black/90 backdrop-blur-md hidden flex items-center justify-center p-4">
            <div
                class="glass-panel max-w-4xl w-full h-[80vh] rounded-xl border border-purple-500/50 flex flex-col clip-corners relative">
                <button onclick="document.getElementById('intel-modal').classList.add('hidden')"
                    class="absolute top-4 right-4 text-gray-400 hover:text-white z-10 bg-black/50 p-2 rounded-full"><i
                        class="ph-bold ph-x text-xl"></i></button>

                <div class="p-6 border-b border-white/10 bg-purple-900/20">
                    <h2 class="text-3xl font-bold orbitron text-white">SYSTEM INTELLIGENCE</h2>
                    <p class="text-purple-300 font-mono text-sm">CLASSIFIED DATA LOGS</p>
                </div>

                <div class="flex-1 overflow-y-auto p-6 space-y-8 custom-scrollbar">

                    <!-- Section: Formation -->
                    <div class="grid md:grid-cols-2 gap-8">
                        <div>
                            <h3 class="text-xl font-bold text-white mb-3 flex items-center gap-2"><i
                                    class="ph-fill ph-sparkle text-yellow-400"></i> FORMATION</h3>
                            <p class="text-gray-300 text-sm leading-relaxed">
                                Formed ~4.6 billion years ago from a giant rotating cloud of gas and dust (solar
                                nebula). Gravity caused the cloud to collapse, creating the Sun, while the remaining
                                material flattened into a disk to form planets, moons, and asteroids.
                            </p>
                        </div>
                        <div>
                            <h3 class="text-xl font-bold text-white mb-3 flex items-center gap-2"><i
                                    class="ph-fill ph-ruler text-cyan-400"></i> SYSTEM SIZE</h3>
                            <ul class="text-sm text-gray-300 space-y-2">
                                <li><strong class="text-white">Neptune:</strong> ~4.5 billion km from Sun.</li>
                                <li><strong class="text-white">Oort Cloud:</strong> Extends 1-2 light years away.</li>
                                <li><strong class="text-white">Mass:</strong> The Sun creates 99.86% of the system's
                                    mass.</li>
                            </ul>
                        </div>
                    </div>

                    <!-- Divider -->
                    <div class="h-px bg-gradient-to-r from-transparent via-white/20 to-transparent"></div>

                    <!-- Section: Minor Bodies -->
                    <div>
                        <h3 class="text-xl font-bold text-white mb-4">MINOR CELESTIAL BODIES</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="bg-slate-800/50 p-4 rounded border border-white/5">
                                <div class="text-green-400 font-bold mb-1"><i class="ph-bold ph-asterisk"></i> ASTEROIDS
                                </div>
                                <p class="text-xs text-gray-400">Rocky bodies mostly found between Mars and Jupiter.
                                    Largest is Ceres.</p>
                            </div>
                            <div class="bg-slate-800/50 p-4 rounded border border-white/5">
                                <div class="text-blue-400 font-bold mb-1"><i class="ph-bold ph-shooting-star"></i>
                                    COMETS</div>
                                <p class="text-xs text-gray-400">Ice + Dust objects known for glowing tails. Originate
                                    in Kuiper Belt or Oort Cloud.</p>
                            </div>
                            <div class="bg-slate-800/50 p-4 rounded border border-white/5">
                                <div class="text-purple-400 font-bold mb-1"><i class="ph-bold ph-planet"></i> DWARF
                                    PLANETS</div>
                                <p class="text-xs text-gray-400">Pluto, Eris, Haumea, Makemake. Pluto was a planet until
                                    2006.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Section: Deep Space -->
                    <div class="grid md:grid-cols-2 gap-4">
                        <div class="bg-blue-900/10 p-4 rounded border-l-2 border-blue-500">
                            <h4 class="font-bold text-white">ðŸŒŒ KUIPER BELT</h4>
                            <p class="text-xs text-gray-300 mt-1">Region beyond Neptune containing icy objects and dwarf
                                planets.</p>
                        </div>
                        <div class="bg-slate-900/10 p-4 rounded border-l-2 border-gray-500">
                            <h4 class="font-bold text-white">ðŸŒ‘ OORT CLOUD</h4>
                            <p class="text-xs text-gray-300 mt-1">The farthest edge. A huge spherical shell of icy
                                bodies; source of long-period comets.</p>
                        </div>
                    </div>

                </div>
            </div>
        </div>

    </main>

    <!-- Modal for Quizzes -->
    <div id="quiz-modal"
        class="fixed inset-0 z-[100] bg-black/90 backdrop-blur-md hidden flex items-center justify-center p-4">
        <div
            class="glass-panel max-w-lg w-full rounded-none border border-cyan-500/50 p-8 relative animate-float shadow-[0_0_50px_rgba(34,211,238,0.1)] clip-corners">
            <button onclick="app.closeQuiz()" class="absolute top-4 right-4 text-gray-400 hover:text-white"><i
                    class="ph-bold ph-x text-xl"></i></button>
            <div class="text-center mb-6">
                <div class="w-full h-1 bg-slate-800 rounded-full mb-4 overflow-hidden">
                    <div id="quiz-progress" class="h-full bg-cyan-400 transition-all duration-300" style="width: 0%">
                    </div>
                </div>
                <div
                    class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-cyan-500/10 text-cyan-400 mb-4 border border-cyan-500 shadow-[0_0_15px_rgba(34,211,238,0.3)]">
                    <i class="ph-fill ph-brain text-3xl"></i>
                </div>
                <h3 id="quiz-title" class="text-2xl font-bold orbitron text-white tracking-widest">SYSTEM CHECK</h3>
                <p id="quiz-subtitle" class="text-gray-400 text-sm font-mono">Verify knowledge to update mission log.
                </p>
            </div>
            <div id="quiz-question-container"></div>
            <div id="quiz-feedback" class="hidden mt-6 text-center p-4 bg-white/5 border border-white/10"></div>
        </div>
    </div>

    <!-- Modal for Item Details -->
    <div id="detail-modal"
        class="fixed inset-0 z-[100] bg-black/95 backdrop-blur-xl hidden flex items-center justify-center p-4">
        <div
            class="glass-panel max-w-3xl w-full overflow-hidden relative shadow-2xl shadow-cyan-900/40 border border-cyan-500/30 flex flex-col md:flex-row clip-corners stagger-item">
            <button onclick="app.closeDetail()"
                class="absolute top-4 right-4 z-50 text-white bg-black/50 hover:bg-red-500/80 w-8 h-8 flex items-center justify-center transition-colors border border-white/20"><i
                    class="ph-bold ph-x"></i></button>
            <div id="detail-content" class="contents"></div>
        </div>
    </div>

    <script>
        // --- HELPER ---
        function toRadians(angle) { return angle * (Math.PI / 180); }

        // --- 2. 3D STAR SYSTEM ENGINE (Background) ---
        const starSystem = {
            canvas: document.getElementById('star-canvas'),
            ctx: document.getElementById('star-canvas').getContext('2d'),
            width: 0, height: 0, stars: [], numStars: 200, speedMultiplier: 1, mouse: { x: 0, y: 0 },
            init: () => {
                starSystem.width = window.innerWidth; starSystem.height = window.innerHeight;
                starSystem.canvas.width = starSystem.width; starSystem.canvas.height = starSystem.height;
                starSystem.mouse.x = starSystem.width / 2; starSystem.mouse.y = starSystem.height / 2;
                starSystem.stars = [];
                for (let i = 0; i < starSystem.numStars; i++) { starSystem.stars.push(starSystem.createStar()); }
            },
            createStar: () => ({ x: Math.random() * starSystem.width - starSystem.width / 2, y: Math.random() * starSystem.height - starSystem.height / 2, z: Math.random() * starSystem.width, isShooting: false }),
            animate: () => {
                const { ctx, width, height, stars } = starSystem;
                ctx.fillStyle = starSystem.speedMultiplier > 1 ? 'rgba(5, 11, 20, 0.2)' : 'rgba(5, 11, 20, 1)';
                ctx.fillRect(0, 0, width, height);
                const offsetX = (starSystem.mouse.x - width / 2) * 0.1; const offsetY = (starSystem.mouse.y - height / 2) * 0.1;

                if (Math.random() > 0.98 && starSystem.speedMultiplier === 1) {
                    stars.push({ x: Math.random() * width - width / 2, y: Math.random() * height - height / 2, z: Math.random() * width / 2, isShooting: true, vx: (Math.random() - 0.5) * 50, vy: (Math.random() - 0.5) * 50 });
                }

                for (let i = 0; i < stars.length; i++) {
                    let star = stars[i];
                    if (star.isShooting) {
                        star.x += star.vx; star.y += star.vy; star.z -= 10;
                        if (star.z <= 0 || Math.abs(star.x) > width || Math.abs(star.y) > height) { stars.splice(i, 1); i--; continue; }
                        const k = 128.0 / star.z; const px = (star.x - offsetX) * k + width / 2; const py = (star.y - offsetY) * k + height / 2; const size = (1 - star.z / width) * 3;
                        ctx.beginPath(); ctx.strokeStyle = `rgba(255, 255, 255, ${1 - star.z / width})`; ctx.lineWidth = size; ctx.moveTo(px, py); ctx.lineTo(px - star.vx * 2, py - star.vy * 2); ctx.stroke(); continue;
                    }
                    star.z -= (1 * starSystem.speedMultiplier);
                    if (star.z <= 0) { star.z = width; star.x = Math.random() * width - width / 2; star.y = Math.random() * height - height / 2; }
                    const k = 128.0 / star.z; const px = (star.x - offsetX) * k + width / 2; const py = (star.y - offsetY) * k + height / 2; let size = (1 - star.z / width) * 2; let opacity = (1 - star.z / width);
                    if (px >= 0 && px <= width && py >= 0 && py <= height) {
                        ctx.beginPath();
                        if (starSystem.speedMultiplier > 10) {
                            const prevK = 128.0 / (star.z + 150); const prevPx = (star.x - offsetX) * prevK + width / 2; const prevPy = (star.y - offsetY) * prevK + height / 2;
                            ctx.strokeStyle = `rgba(34, 211, 238, ${opacity})`; ctx.lineWidth = size * 1.5; ctx.moveTo(prevPx, prevPy); ctx.lineTo(px, py); ctx.stroke();
                        } else {
                            ctx.fillStyle = `rgba(200, 220, 255, ${opacity})`; ctx.arc(px, py, size, 0, Math.PI * 2); ctx.fill();
                            if (size > 1.5) { ctx.shadowBlur = 10; ctx.shadowColor = "white"; } else { ctx.shadowBlur = 0; }
                        }
                        ctx.shadowBlur = 0;
                    }
                }
                requestAnimationFrame(starSystem.animate);
            }
        };

        // --- 3. 3D SOLAR SYSTEM LOGIC (Holo-Deck) ---
        const solarApp = {
            scene: null, camera: null, renderer: null,
            planets: [], asteroids: null, kuiperBelt: null, sun: null, sunGlow: null,
            measureMode: false, selectedPlanets: [],
            raycaster: new THREE.Raycaster(), mouse: new THREE.Vector2(),
            isDragging: false, previousMousePosition: { x: 0, y: 0 },

            planetData: [
                {
                    name: "Sun", color: "#FDB813", size: 6, distance: 0, speed: 0, type: "Yellow Dwarf Star", textureType: "sun",
                    realDistanceFromSun: 0, // km
                    desc: "Core ~15MÂ°C. Mass: 99.86% of Solar System. Will become a Red Giant in ~5B years.",
                    stats: { "Diameter": "1.39M km", "Surface Temp": "5,500Â°C", "Age": "4.6B Years" },
                    fact: "Controls all planetary orbits and powers weather on Earth."
                },
                {
                    name: "Mercury", color: "#A5A5A5", size: 0.8, distance: 12, speed: 0.02, type: "Inner Planet", textureType: "noise",
                    realDistanceFromSun: 57.9, // million km
                    desc: "Closest to Sun. No atmosphere â†’ extreme temps. Day +430Â°C, Night -180Â°C.",
                    stats: { "Diameter": "4,879 km", "Moons": "0", "Orbit": "88 Days" },
                    fact: "It takes 59 Earth days to rotate once but only 88 days to orbit the Sun."
                },
                {
                    name: "Venus", color: "#E3BB76", size: 1.5, distance: 18, speed: 0.015, type: "Inner Planet", textureType: "atmosphere",
                    realDistanceFromSun: 108.2, // million km
                    desc: "Hottest planet due to thick CO2 greenhouse effect. Rotates backward.",
                    stats: { "Diameter": "12,104 km", "Temp": "465Â°C", "Moons": "0" },
                    fact: "A day on Venus is longer than its year."
                },
                {
                    name: "Earth", color: "#2233ff", size: 1.6, distance: 26, speed: 0.01, type: "Inner Planet", textureType: "earth", hasMoon: true,
                    realDistanceFromSun: 149.6, // million km (1 AU)
                    desc: "Only planet known to support life. Atmosphere: Nitrogen + Oxygen.",
                    stats: { "Diameter": "12,742 km", "Moons": "1", "Water": "71%" },
                    fact: "Earth's magnetic field protects us from solar radiation. Moon drifts 3.8cm away/year."
                },
                {
                    name: "Mars", color: "#E27B58", size: 1.2, distance: 34, speed: 0.008, type: "Inner Planet", textureType: "noise",
                    realDistanceFromSun: 227.9, // million km
                    desc: "The Red Planet (Iron Oxide). Thin CO2 atmosphere. Past water evidence.",
                    stats: { "Diameter": "6,779 km", "Moons": "2", "Volcano": "Olympus Mons" },
                    fact: "Home to Olympus Mons, the largest volcano in the Solar System."
                },
                {
                    name: "Jupiter", color: "#C88B3A", size: 4.5, distance: 55, speed: 0.004, type: "Gas Giant", textureType: "banded",
                    realDistanceFromSun: 778.5, // million km
                    desc: "Largest planet. H + He composition. Great Red Spot storm.",
                    stats: { "Diameter": "139,820 km", "Moons": "95+", "Day": "~10 Hours" },
                    fact: "Jupiter is bigger than all other planets combined."
                },
                {
                    name: "Saturn", color: "#C5AB6E", size: 4.0, distance: 75, speed: 0.002, type: "Gas Giant", hasRing: true, textureType: "banded",
                    realDistanceFromSun: 1434, // million km
                    desc: "Most spectacular ring system (ice + dust). Titan has thick atmosphere.",
                    stats: { "Diameter": "116,460 km", "Moons": "140+", "Density": "Low" },
                    fact: "Saturn is the least dense planet â€” it could float on water."
                },
                {
                    name: "Uranus", color: "#4FD0E7", size: 2.8, distance: 95, speed: 0.001, type: "Ice Giant", textureType: "atmosphere",
                    realDistanceFromSun: 2871, // million km
                    desc: "Blue-green color due to methane. Unique tilt: 98Â°.",
                    stats: { "Diameter": "50,724 km", "Moons": "27", "Tilt": "98 Degrees" },
                    fact: "It rotates on its side!"
                },
                {
                    name: "Neptune", color: "#4b70dd", size: 2.7, distance: 110, speed: 0.0008, type: "Ice Giant", textureType: "noise",
                    realDistanceFromSun: 4495, // million km
                    desc: "Farthest planet. Fastest winds (~2,000 km/h).",
                    stats: { "Diameter": "49,244 km", "Moons": "14", "Winds": "2,000 km/h" },
                    fact: "Triton is its largest moon."
                },
                {
                    name: "Pluto", color: "#d1c4b2", size: 0.6, distance: 130, speed: 0.0005, type: "Dwarf Planet", textureType: "noise",
                    realDistanceFromSun: 5906, // million km
                    desc: "Reclassified as Dwarf Planet in 2006. Located in Kuiper Belt.",
                    stats: { "Diameter": "2,376 km", "Moons": "5", "Orbit": "248 Years" },
                    fact: "Sometimes its orbit brings it closer to the Sun than Neptune."
                }
            ],

            init: () => {
                const container = document.getElementById('canvas-container');
                if (!container) {
                    console.error('Canvas container not found!');
                    return;
                }

                // Clean up previous instance if exists
                if (solarApp.renderer) {
                    solarApp.renderer.dispose();
                    container.innerHTML = '';
                }

                solarApp.scene = new THREE.Scene();
                solarApp.camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
                solarApp.camera.position.set(0, 80, 140);
                solarApp.camera.lookAt(0, 0, 0);

                // Create renderer with proper settings
                solarApp.renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
                solarApp.renderer.setSize(window.innerWidth, window.innerHeight);
                solarApp.renderer.domElement.id = 'solar-canvas';

                container.innerHTML = '';
                container.appendChild(solarApp.renderer.domElement);

                const ambientLight = new THREE.AmbientLight(0x404040, 0.8);
                solarApp.scene.add(ambientLight);

                const sunLight = new THREE.PointLight(0xffffff, 1.5, 400);
                sunLight.position.set(0, 0, 0);
                solarApp.scene.add(sunLight);

                solarApp.createObjects();
                solarApp.createAsteroidBelt();
                solarApp.createKuiperBelt();
                solarApp.addControls(container);

                window.addEventListener('resize', solarApp.onWindowResize, false);
                solarApp.animate();
            },

            generateTexture: (type, colorHex) => {
                const size = 768; // Optimized resolution for balance of quality and performance
                const canvas = document.createElement('canvas');
                canvas.width = size; canvas.height = size;
                const ctx = canvas.getContext('2d');

                // Base color with gradient
                const gradient = ctx.createRadialGradient(size * 0.3, size * 0.3, 0, size / 2, size / 2, size / 2);
                gradient.addColorStop(0, solarApp.lightenColor(colorHex, 30));
                gradient.addColorStop(0.7, colorHex);
                gradient.addColorStop(1, solarApp.darkenColor(colorHex, 40));
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, size, size);

                if (type === 'banded') {
                    // Enhanced gas giant bands with turbulence
                    for (let i = 0; i < 40; i++) {
                        const y = (i / 40) * size + (Math.random() - 0.5) * 30;
                        const h = Math.random() * 40 + 15;
                        const waveOffset = Math.sin(i * 0.5) * 20;

                        ctx.save();
                        ctx.translate(waveOffset, 0);

                        const bandGrad = ctx.createLinearGradient(0, y, 0, y + h);
                        bandGrad.addColorStop(0, `rgba(0,0,0,${Math.random() * 0.3})`);
                        bandGrad.addColorStop(0.5, `rgba(255,255,255,${Math.random() * 0.15})`);
                        bandGrad.addColorStop(1, `rgba(0,0,0,${Math.random() * 0.25})`);
                        ctx.fillStyle = bandGrad;
                        ctx.fillRect(0, y, size, h);
                        ctx.restore();
                    }
                    // Add storm spots (like Jupiter's Great Red Spot)
                    for (let i = 0; i < 5; i++) {
                        const x = Math.random() * size;
                        const y = Math.random() * size;
                        const rx = Math.random() * 80 + 40;
                        const ry = Math.random() * 50 + 25;
                        ctx.save();
                        ctx.translate(x, y);
                        ctx.rotate(Math.random() * Math.PI);
                        ctx.beginPath();
                        ctx.ellipse(0, 0, rx, ry, 0, 0, Math.PI * 2);
                        ctx.fillStyle = `rgba(180, 50, 30, ${Math.random() * 0.3 + 0.2})`;
                        ctx.fill();
                        ctx.restore();
                    }
                } else if (type === 'noise') {
                    // Enhanced rocky surface with craters and terrain
                    for (let i = 0; i < 200; i++) {
                        const x = Math.random() * size;
                        const y = Math.random() * size;
                        const r = Math.random() * 40 + 5;
                        ctx.beginPath();
                        ctx.arc(x, y, r, 0, Math.PI * 2);
                        const craterGrad = ctx.createRadialGradient(x - r / 3, y - r / 3, 0, x, y, r);
                        craterGrad.addColorStop(0, `rgba(255,255,255,${Math.random() * 0.1})`);
                        craterGrad.addColorStop(0.7, `rgba(0,0,0,${Math.random() * 0.2 + 0.1})`);
                        craterGrad.addColorStop(1, `rgba(0,0,0,${Math.random() * 0.15})`);
                        ctx.fillStyle = craterGrad;
                        ctx.fill();
                    }
                    // Add surface variation
                    for (let i = 0; i < 100; i++) {
                        const x = Math.random() * size;
                        const y = Math.random() * size;
                        const w = Math.random() * 60 + 20;
                        const h = Math.random() * 40 + 10;
                        ctx.fillStyle = `rgba(${Math.random() > 0.5 ? 255 : 0},${Math.random() > 0.5 ? 255 : 0},${Math.random() > 0.5 ? 255 : 0},${Math.random() * 0.08})`;
                        ctx.fillRect(x, y, w, h);
                    }
                } else if (type === 'earth') {
                    // Enhanced Earth with continents and clouds
                    ctx.fillStyle = '#2233ff';
                    ctx.fillRect(0, 0, size, size);

                    // Continents
                    ctx.fillStyle = '#4fa35a';
                    for (let i = 0; i < 50; i++) {
                        const x = Math.random() * size;
                        const y = Math.random() * size;
                        const r = Math.random() * 120 + 40;
                        ctx.beginPath();
                        ctx.arc(x, y, r, 0, Math.PI * 2);
                        ctx.fill();
                    }

                    // Ice caps
                    ctx.fillStyle = 'rgba(255,255,255,0.9)';
                    ctx.beginPath();
                    ctx.arc(size / 2, 0, size * 0.15, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.beginPath();
                    ctx.arc(size / 2, size, size * 0.15, 0, Math.PI * 2);
                    ctx.fill();

                    // Cloud layer
                    ctx.fillStyle = 'rgba(255,255,255,0.4)';
                    for (let i = 0; i < 80; i++) {
                        const x = Math.random() * size;
                        const y = Math.random() * size;
                        const w = Math.random() * 150 + 50;
                        const h = Math.random() * 50 + 20;
                        ctx.save();
                        ctx.translate(x, y);
                        ctx.rotate(Math.random() * Math.PI);
                        ctx.beginPath();
                        ctx.ellipse(0, 0, w, h, 0, 0, Math.PI * 2);
                        ctx.fill();
                        ctx.restore();
                    }
                } else if (type === 'sun') {
                    // Enhanced sun with solar activity
                    const sunGrad = ctx.createRadialGradient(size / 2, size / 2, 0, size / 2, size / 2, size / 2);
                    sunGrad.addColorStop(0, '#FFEB3B');
                    sunGrad.addColorStop(0.4, '#FFC107');
                    sunGrad.addColorStop(0.7, '#FF9800');
                    sunGrad.addColorStop(1, '#FF5722');
                    ctx.fillStyle = sunGrad;
                    ctx.fillRect(0, 0, size, size);

                    // Solar flares and activity
                    for (let i = 0; i < 300; i++) {
                        const x = Math.random() * size;
                        const y = Math.random() * size;
                        const r = Math.random() * 50 + 10;
                        ctx.beginPath();
                        ctx.arc(x, y, r, 0, Math.PI * 2);
                        ctx.fillStyle = `rgba(255, ${Math.random() * 100 + 100}, 0, ${Math.random() * 0.15})`;
                        ctx.fill();
                    }

                    // Sunspots
                    for (let i = 0; i < 15; i++) {
                        const x = Math.random() * size;
                        const y = Math.random() * size;
                        const r = Math.random() * 30 + 10;
                        ctx.beginPath();
                        ctx.arc(x, y, r, 0, Math.PI * 2);
                        ctx.fillStyle = `rgba(100, 50, 0, ${Math.random() * 0.3 + 0.2})`;
                        ctx.fill();
                    }
                } else if (type === 'atmosphere') {
                    // Enhanced atmospheric planets (Venus, Uranus)
                    const atmGrad = ctx.createRadialGradient(size * 0.35, size * 0.35, 0, size / 2, size / 2, size / 2);
                    atmGrad.addColorStop(0, solarApp.lightenColor(colorHex, 40));
                    atmGrad.addColorStop(0.6, colorHex);
                    atmGrad.addColorStop(1, solarApp.darkenColor(colorHex, 30));
                    ctx.fillStyle = atmGrad;
                    ctx.fillRect(0, 0, size, size);

                    // Atmospheric swirls
                    for (let i = 0; i < 60; i++) {
                        const x = Math.random() * size;
                        const y = Math.random() * size;
                        const r = Math.random() * 80 + 30;
                        ctx.beginPath();
                        ctx.arc(x, y, r, 0, Math.PI * 2);
                        ctx.fillStyle = `rgba(255,255,255,${Math.random() * 0.08})`;
                        ctx.fill();
                    }
                }

                const texture = new THREE.CanvasTexture(canvas);
                texture.needsUpdate = true;
                return texture;
            },

            // Helper functions for color manipulation
            lightenColor: (hex, percent) => {
                const num = parseInt(hex.replace('#', ''), 16);
                const r = Math.min(255, ((num >> 16) & 0xff) + percent);
                const g = Math.min(255, ((num >> 8) & 0xff) + percent);
                const b = Math.min(255, (num & 0xff) + percent);
                return `rgb(${r},${g},${b})`;
            },

            darkenColor: (hex, percent) => {
                const num = parseInt(hex.replace('#', ''), 16);
                const r = Math.max(0, ((num >> 16) & 0xff) - percent);
                const g = Math.max(0, ((num >> 8) & 0xff) - percent);
                const b = Math.max(0, (num & 0xff) - percent);
                return `rgb(${r},${g},${b})`;
            },

            createGlow: (size, color) => {
                const canvas = document.createElement('canvas');
                canvas.width = 128; canvas.height = 128;
                const context = canvas.getContext('2d');
                const gradient = context.createRadialGradient(64, 64, 0, 64, 64, 64);
                gradient.addColorStop(0, color);
                gradient.addColorStop(0.2, color);
                gradient.addColorStop(0.5, 'rgba(0,0,0,0.1)');
                gradient.addColorStop(1, 'rgba(0,0,0,0)');
                context.fillStyle = gradient; context.fillRect(0, 0, 128, 128);
                const tex = new THREE.CanvasTexture(canvas);
                tex.needsUpdate = true;
                const sprite = new THREE.Sprite(new THREE.SpriteMaterial({ map: tex, color: 0xffffff, transparent: true, blending: THREE.AdditiveBlending }));
                sprite.scale.set(size * 3, size * 3, 1);
                return sprite;
            },

            createObjects: () => {
                solarApp.planets = [];
                solarApp.planetData.forEach(p => {
                    const texture = solarApp.generateTexture(p.textureType, p.color);

                    // Use MeshStandardMaterial for better lighting and realism
                    let material = p.name === "Sun" ?
                        new THREE.MeshBasicMaterial({ map: texture, emissive: 0xFFAA00, emissiveIntensity: 1 }) :
                        new THREE.MeshStandardMaterial({
                            map: texture,
                            roughness: p.textureType === 'banded' || p.textureType === 'atmosphere' ? 0.8 : 0.6,
                            metalness: 0.1
                        });

                    const planet = new THREE.Mesh(new THREE.SphereGeometry(p.size, 64, 64), material);

                    planet.position.x = p.distance;

                    // Enhanced orbit rings with glow
                    if (p.distance > 0) {
                        const orbit = new THREE.Mesh(
                            new THREE.RingGeometry(p.distance - 0.15, p.distance + 0.15, 128),
                            new THREE.MeshBasicMaterial({
                                color: parseInt(p.color.replace('#', '0x')),
                                opacity: 0.08,
                                transparent: true,
                                side: THREE.DoubleSide
                            })
                        );
                        orbit.rotation.x = Math.PI / 2;
                        solarApp.scene.add(orbit);
                    }

                    // Enhanced Sun with multi-layered corona
                    if (p.name === "Sun") {
                        // Inner glow
                        const innerGlow = solarApp.createGlow(p.size * 0.8, '#FFEB3B');
                        planet.add(innerGlow);

                        // Middle glow
                        const middleGlow = solarApp.createGlow(p.size * 1.2, '#FFA726');
                        planet.add(middleGlow);

                        // Outer glow
                        const outerGlow = solarApp.createGlow(p.size * 1.6, '#FF6F00');
                        solarApp.sunGlow = outerGlow;
                        planet.add(outerGlow);
                    }

                    // Add atmospheric glow to all planets (except Sun)
                    if (p.distance > 0) {
                        const glowColor = p.color;
                        const atmosphereGlow = solarApp.createGlow(p.size * 1.3, glowColor);
                        atmosphereGlow.material.opacity = 0.3;
                        planet.add(atmosphereGlow);

                        // Add subtle outer atmosphere layer
                        const atmosphereMesh = new THREE.Mesh(
                            new THREE.SphereGeometry(p.size + 0.2, 64, 64),
                            new THREE.MeshBasicMaterial({
                                color: parseInt(p.color.replace('#', '0x')),
                                transparent: true,
                                opacity: 0.1,
                                side: THREE.BackSide
                            })
                        );
                        planet.add(atmosphereMesh);
                    }

                    // Enhanced Earth atmosphere
                    if (p.textureType === 'earth') {
                        const blueGlow = solarApp.createGlow(p.size * 1.4, '#4FC3F7');
                        blueGlow.material.opacity = 0.4;
                        planet.add(blueGlow);
                    }

                    // Enhanced atmospheric planets
                    if (p.textureType === 'atmosphere') {
                        const atmGlow = solarApp.createGlow(p.size * 1.5, p.color);
                        atmGlow.material.opacity = 0.35;
                        planet.add(atmGlow);
                    }

                    // Enhanced Moon for Earth
                    if (p.hasMoon) {
                        const moonTexture = solarApp.generateTexture('noise', '#CCCCCC');
                        const moon = new THREE.Mesh(
                            new THREE.SphereGeometry(0.4, 32, 32),
                            new THREE.MeshStandardMaterial({ map: moonTexture, roughness: 0.9 })
                        );
                        moon.position.set(3, 0, 0);
                        planet.add(moon);
                        planet.userData.moon = moon;
                    }

                    // Enhanced Saturn rings with better texture
                    if (p.hasRing) {
                        const ringCanvas = document.createElement('canvas');
                        ringCanvas.width = 256; ringCanvas.height = 256;
                        const rctx = ringCanvas.getContext('2d');

                        // Create more detailed ring texture
                        const rgrad = rctx.createRadialGradient(128, 128, 0, 128, 128, 128);
                        rgrad.addColorStop(0, 'rgba(200,200,200,0)');
                        rgrad.addColorStop(0.3, 'rgba(200,200,200,0)');
                        rgrad.addColorStop(0.35, 'rgba(220,200,180,0.9)');
                        rgrad.addColorStop(0.45, 'rgba(180,160,140,0.7)');
                        rgrad.addColorStop(0.5, 'rgba(200,180,160,0.85)');
                        rgrad.addColorStop(0.6, 'rgba(160,140,120,0.6)');
                        rgrad.addColorStop(0.7, 'rgba(190,170,150,0.8)');
                        rgrad.addColorStop(0.85, 'rgba(150,130,110,0.4)');
                        rgrad.addColorStop(1, 'rgba(200,200,200,0)');
                        rctx.fillStyle = rgrad;
                        rctx.fillRect(0, 0, 256, 256);

                        // Add ring detail lines
                        for (let i = 0; i < 20; i++) {
                            const radius = 40 + Math.random() * 80;
                            rctx.beginPath();
                            rctx.arc(128, 128, radius, 0, Math.PI * 2);
                            rctx.strokeStyle = `rgba(0,0,0,${Math.random() * 0.1})`;
                            rctx.lineWidth = Math.random() * 2 + 0.5;
                            rctx.stroke();
                        }

                        const ringTex = new THREE.CanvasTexture(ringCanvas);
                        ringTex.needsUpdate = true;

                        const ring = new THREE.Mesh(
                            new THREE.RingGeometry(p.size + 1.5, p.size + 5, 128),
                            new THREE.MeshBasicMaterial({
                                map: ringTex,
                                side: THREE.DoubleSide,
                                transparent: true,
                                opacity: 0.9
                            })
                        );
                        ring.rotation.x = Math.PI / 2.2; // Slight tilt for realism
                        planet.add(ring);

                        // Add ring glow
                        const ringGlow = solarApp.createGlow(p.size * 2.5, '#D4AF37');
                        ringGlow.material.opacity = 0.15;
                        planet.add(ringGlow);
                    }

                    planet.userData = { ...p, angle: Math.random() * Math.PI * 2, orbitSpeed: p.speed };
                    solarApp.scene.add(planet);
                    solarApp.planets.push(planet);
                });
            },

            createAsteroidBelt: () => {
                const geometry = new THREE.BufferGeometry();
                const vertices = [];
                const colors = [];
                const sizes = [];

                for (let i = 0; i < 600; i++) {
                    const dist = 42 + Math.random() * 6;
                    const angle = Math.random() * Math.PI * 2;
                    const x = Math.cos(angle) * dist;
                    const y = (Math.random() - 0.5) * 3;
                    const z = Math.sin(angle) * dist;
                    vertices.push(x, y, z);

                    // Varied colors - gray to brown
                    const brightness = 0.4 + Math.random() * 0.4;
                    colors.push(brightness, brightness * 0.9, brightness * 0.7);
                    sizes.push(Math.random() * 0.5 + 0.2);
                }

                geometry.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));
                geometry.setAttribute('color', new THREE.Float32BufferAttribute(colors, 3));
                geometry.setAttribute('size', new THREE.Float32BufferAttribute(sizes, 1));

                const material = new THREE.PointsMaterial({
                    size: 0.4,
                    vertexColors: true,
                    transparent: true,
                    opacity: 0.8,
                    sizeAttenuation: true
                });

                solarApp.asteroids = new THREE.Points(geometry, material);
                solarApp.scene.add(solarApp.asteroids);
            },

            createKuiperBelt: () => {
                const geometry = new THREE.BufferGeometry();
                const vertices = [];
                const colors = [];

                for (let i = 0; i < 900; i++) {
                    const dist = 120 + Math.random() * 30;
                    const angle = Math.random() * Math.PI * 2;
                    const x = Math.cos(angle) * dist;
                    const y = (Math.random() - 0.5) * 6;
                    const z = Math.sin(angle) * dist;
                    vertices.push(x, y, z);

                    // Icy blue-white colors
                    const brightness = 0.6 + Math.random() * 0.4;
                    colors.push(brightness * 0.9, brightness * 0.95, brightness);
                }

                geometry.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));
                geometry.setAttribute('color', new THREE.Float32BufferAttribute(colors, 3));

                const material = new THREE.PointsMaterial({
                    size: 0.5,
                    vertexColors: true,
                    transparent: true,
                    opacity: 0.7,
                    sizeAttenuation: true
                });

                solarApp.kuiperBelt = new THREE.Points(geometry, material);
                solarApp.scene.add(solarApp.kuiperBelt);
            },

            addControls: (domElement) => {
                let isDragging = false;
                let previousMousePosition = { x: 0, y: 0 };
                domElement.addEventListener('mousedown', (e) => { isDragging = true; });
                domElement.addEventListener('mousemove', (e) => {
                    const deltaMove = { x: e.offsetX - previousMousePosition.x, y: e.offsetY - previousMousePosition.y };
                    if (isDragging) {
                        const deltaRotationQuaternion = new THREE.Quaternion().setFromEuler(new THREE.Euler(toRadians(deltaMove.y * 0.3), toRadians(deltaMove.x * 0.3), 0, 'XYZ'));
                        solarApp.scene.quaternion.multiplyQuaternions(deltaRotationQuaternion, solarApp.scene.quaternion);
                    }
                    previousMousePosition = { x: e.offsetX, y: e.offsetY };
                });
                document.addEventListener('mouseup', () => { isDragging = false; });
                domElement.addEventListener('wheel', (e) => {
                    solarApp.camera.position.z += e.deltaY * 0.1;
                    solarApp.camera.position.z = Math.max(10, Math.min(solarApp.camera.position.z, 250));
                });
                domElement.addEventListener('click', (event) => {
                    solarApp.mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
                    solarApp.mouse.y = - (event.clientY / window.innerHeight) * 2 + 1;
                    solarApp.raycaster.setFromCamera(solarApp.mouse, solarApp.camera);
                    const intersects = solarApp.raycaster.intersectObjects(solarApp.planets);
                    if (intersects.length > 0) { solarApp.handlePlanetClick(intersects[0].object); }
                });
            },

            handlePlanetClick: (mesh) => {
                const data = mesh.userData;
                if (solarApp.measureMode) {
                    solarApp.selectedPlanets.push({ name: data.name, mesh: mesh, userData: data });
                    const out = document.getElementById('measure-output');

                    // Helper to add selection ring
                    const addSelectionRing = (planetMesh) => {
                        const ringGeo = new THREE.RingGeometry(planetMesh.userData.size * 1.5, planetMesh.userData.size * 1.6, 64);
                        const ringMat = new THREE.MeshBasicMaterial({
                            color: 0x00ff00,
                            side: THREE.DoubleSide,
                            transparent: true,
                            opacity: 0.8
                        });
                        const ring = new THREE.Mesh(ringGeo, ringMat);
                        ring.rotation.x = Math.PI / 2; // Lie flat
                        // Make it always face camera if needed, or just lie flat
                        // Actually, let's make it a billboard sprite for better visibility or a rotating bracket
                        // Simple ring around the planet is good
                        ring.name = "selectionRing";
                        planetMesh.add(ring);
                    };

                    if (solarApp.selectedPlanets.length === 1) {
                        out.innerHTML = `<span class="text-cyan-400">START:</span> <span class="text-white font-bold">${data.name}</span><br><span class="text-gray-400 text-xs">Click another planet to measure distance...</span>`;
                        addSelectionRing(mesh);
                    } else if (solarApp.selectedPlanets.length === 2) {
                        const planet1 = solarApp.selectedPlanets[0];
                        const planet2 = solarApp.selectedPlanets[1];

                        // Add ring to second planet
                        addSelectionRing(planet2.mesh);

                        // Calculate real astronomical distances
                        const realDistances = solarApp.calculateRealDistance(planet1.userData, planet2.userData);

                        // Create animated glowing line
                        const p1 = planet1.mesh.position;
                        const p2 = planet2.mesh.position;

                        // Create line with glow effect
                        const lineMaterial = new THREE.LineBasicMaterial({
                            color: 0x00ffff,
                            linewidth: 2
                        });
                        const lineGeometry = new THREE.BufferGeometry().setFromPoints([p1, p2]);
                        const line = new THREE.Line(lineGeometry, lineMaterial);
                        line.name = "measureLine";
                        solarApp.scene.add(line);

                        // Add glow tube around line
                        const direction = new THREE.Vector3().subVectors(p2, p1);
                        const distance = direction.length();
                        const tubeGeometry = new THREE.CylinderGeometry(0.1, 0.1, distance, 8);
                        const tubeMaterial = new THREE.MeshBasicMaterial({
                            color: 0x00ffff,
                            transparent: true,
                            opacity: 0.3
                        });
                        const tube = new THREE.Mesh(tubeGeometry, tubeMaterial);
                        tube.position.copy(p1).add(direction.multiplyScalar(0.5));
                        tube.quaternion.setFromUnitVectors(
                            new THREE.Vector3(0, 1, 0),
                            direction.normalize()
                        );
                        tube.name = "measureTube";
                        solarApp.scene.add(tube);

                        // Display comprehensive distance information
                        out.innerHTML = `
                            <div class="border-b border-cyan-500/30 pb-2 mb-2">
                                <span class="text-cyan-400 font-bold">DISTANCE MEASUREMENT</span>
                            </div>
                            <div class="text-xs mb-2">
                                <span class="text-gray-400">From:</span> <span class="text-white font-bold">${planet1.name}</span><br>
                                <span class="text-gray-400">To:</span> <span class="text-white font-bold">${planet2.name}</span>
                            </div>
                            <div class="space-y-1 text-xs">
                                <div class="bg-cyan-900/20 p-2 rounded border-l-2 border-cyan-400">
                                    <span class="text-gray-400">Kilometers:</span><br>
                                    <span class="text-white font-mono text-sm">${realDistances.km}</span>
                                </div>
                                <div class="bg-blue-900/20 p-2 rounded border-l-2 border-blue-400">
                                    <span class="text-gray-400">Astronomical Units:</span><br>
                                    <span class="text-white font-mono text-sm">${realDistances.au}</span>
                                </div>
                                ${realDistances.lightMinutes ? `
                                <div class="bg-purple-900/20 p-2 rounded border-l-2 border-purple-400">
                                    <span class="text-gray-400">Light Travel Time:</span><br>
                                    <span class="text-white font-mono text-sm">${realDistances.lightMinutes}</span>
                                </div>
                                ` : ''}
                                ${realDistances.lightYears ? `
                                <div class="bg-yellow-900/20 p-2 rounded border-l-2 border-yellow-400">
                                    <span class="text-gray-400">Light Years:</span><br>
                                    <span class="text-white font-mono text-sm">${realDistances.lightYears}</span>
                                </div>
                                ` : ''}
                            </div>
                            <div class="text-xs text-gray-500 mt-2 italic">
                                ${realDistances.funFact}
                            </div>
                        `;

                        // Animate line pulsing
                        let pulseTime = 0;
                        const pulseInterval = setInterval(() => {
                            pulseTime += 0.1;
                            const opacity = 0.2 + Math.sin(pulseTime * 3) * 0.15;
                            if (tube.material) tube.material.opacity = opacity;
                        }, 50);

                        // Clear after 10 seconds
                        setTimeout(() => {
                            clearInterval(pulseInterval);
                            solarApp.scene.remove(solarApp.scene.getObjectByName("measureLine"));
                            solarApp.scene.remove(solarApp.scene.getObjectByName("measureTube"));

                            // Remove selection rings
                            solarApp.selectedPlanets.forEach(p => {
                                const ring = p.mesh.getObjectByName("selectionRing");
                                if (ring) p.mesh.remove(ring);
                            });

                            solarApp.selectedPlanets = [];
                            out.innerHTML = '<span class="text-gray-400">Select first planet...</span>';
                        }, 10000);
                    }
                } else {
                    const panel = document.getElementById('planet-info-panel');
                    panel.classList.remove('hidden');
                    document.getElementById('p3d-name').innerText = data.name;
                    document.getElementById('p3d-type').innerText = data.type;
                    document.getElementById('p3d-desc').innerText = data.desc;
                    document.getElementById('p3d-fact').innerText = data.fact;

                    let statsHTML = '';
                    for (const [key, value] of Object.entries(data.stats)) {
                        statsHTML += `<div><span class="text-gray-500">${key}:</span> <span class="text-white">${value}</span></div>`;
                    }
                    document.getElementById('p3d-stats').innerHTML = statsHTML;
                }
            },

            calculateRealDistance: (planet1, planet2) => {
                // Calculate distance using real astronomical data
                const dist1 = planet1.realDistanceFromSun || 0; // million km
                const dist2 = planet2.realDistanceFromSun || 0; // million km

                // Calculate actual distance (simplified - assumes circular orbits
                const distanceKm = Math.abs(dist1 - dist2) * 1000000; // convert to km

                // Constants
                const AU = 149597870.7; // km in 1 AU
                const LIGHT_SPEED = 299792.458; // km/s
                const LIGHT_YEAR = 9460730472580.8; // km in 1 light year

                // Calculate in different units
                const distanceAU = distanceKm / AU;
                const lightSeconds = distanceKm / LIGHT_SPEED;
                const lightMinutes = lightSeconds / 60;
                const lightHours = lightMinutes / 60;
                const lightDays = lightHours / 24;
                const lightYears = distanceKm / LIGHT_YEAR;

                // Format results
                const result = {
                    km: distanceKm.toLocaleString('en-US', { maximumFractionDigits: 0 }) + ' km',
                    au: distanceAU.toFixed(3) + ' AU'
                };

                // Add appropriate light travel time
                if (lightYears >= 1) {
                    result.lightYears = lightYears.toFixed(4) + ' light years';
                    result.funFact = `Light would take ${lightYears.toFixed(2)} years to travel this distance!`;
                } else if (lightDays >= 1) {
                    result.lightMinutes = `${lightDays.toFixed(2)} light days (${lightHours.toFixed(1)} hours)`;
                    result.funFact = `A radio signal would take ${lightDays.toFixed(1)} days to travel between these worlds.`;
                } else if (lightHours >= 1) {
                    result.lightMinutes = `${lightHours.toFixed(2)} light hours (${lightMinutes.toFixed(0)} minutes)`;
                    result.funFact = `Light takes ${lightHours.toFixed(1)} hours to cross this distance.`;
                } else if (lightMinutes >= 1) {
                    result.lightMinutes = `${lightMinutes.toFixed(2)} light minutes (${lightSeconds.toFixed(0)} seconds)`;
                    result.funFact = `Sunlight takes ${lightMinutes.toFixed(1)} minutes to reach this distance.`;
                } else {
                    result.lightMinutes = `${lightSeconds.toFixed(2)} light seconds`;
                    result.funFact = `Light travels this distance in just ${lightSeconds.toFixed(1)} seconds!`;
                }

                // Add specific fun facts for certain combinations
                if (planet1.name === "Earth" && planet2.name === "Mars") {
                    result.funFact = "Mars missions take 6-9 months depending on orbital positions!";
                } else if (planet1.name === "Earth" && planet2.name === "Moon") {
                    result.funFact = "Apollo 11 took 3 days to reach the Moon in 1969.";
                } else if ((planet1.name === "Sun" && planet2.name === "Earth") || (planet2.name === "Sun" && planet1.name === "Earth")) {
                    result.funFact = "This is exactly 1 Astronomical Unit (AU) - the baseline for measuring solar system distances!";
                }

                return result;
            },

            closeInfoPanel: () => {
                document.getElementById('planet-info-panel').classList.add('hidden');
            },

            toggleMeasureMode: () => {
                solarApp.measureMode = !solarApp.measureMode;
                const btn = document.getElementById('btn-measure');
                const out = document.getElementById('measure-output');
                if (solarApp.measureMode) {
                    btn.classList.add('bg-blue-600/50');
                    out.classList.remove('hidden');
                    out.innerText = "Select first planet...";
                } else {
                    btn.classList.remove('bg-blue-600/50');
                    out.classList.add('hidden');
                    solarApp.selectedPlanets = [];
                }
            },

            showCosmicIntel: () => {
                document.getElementById('intel-modal').classList.remove('hidden');
            },

            animate: () => {
                requestAnimationFrame(solarApp.animate);
                solarApp.planets.forEach(p => {
                    if (p.userData.distance > 0) {
                        p.userData.angle += p.userData.orbitSpeed;
                        p.position.x = Math.cos(p.userData.angle) * p.userData.distance;
                        p.position.z = Math.sin(p.userData.angle) * p.userData.distance;
                    }
                    p.rotation.y += 0.005;
                    if (p.userData.moon) {
                        const time = Date.now() * 0.001;
                        p.userData.moon.position.x = Math.cos(time * 2) * 3;
                        p.userData.moon.position.z = Math.sin(time * 2) * 3;
                    }
                });
                if (solarApp.asteroids) solarApp.asteroids.rotation.y += 0.0005;
                if (solarApp.kuiperBelt) solarApp.kuiperBelt.rotation.y -= 0.0002;
                if (solarApp.sunGlow) { const scale = 15 + Math.sin(Date.now() * 0.002) * 1; solarApp.sunGlow.scale.set(scale, scale, 1); }
                solarApp.renderer.render(solarApp.scene, solarApp.camera);
            },

            onWindowResize: () => {
                solarApp.camera.aspect = window.innerWidth / window.innerHeight;
                solarApp.camera.updateProjectionMatrix();
                solarApp.renderer.setSize(window.innerWidth, window.innerHeight);
            }
        };

        // --- 1. CORE DATA & I18N ---
        const i18n = {
            en: {
                navSubtitle: "Space Academy", resetData: "Reset Data", currentRank: "Current Rank",
                warpText: "INITIATING WARP DRIVE...", landingTitle: "EXPLORE THE COSMOS",
                landingSubtitle: "Your journey from Earth to the edge of the universe begins here. Complete missions, analyze data, and earn your wings.",
                startBtn: "START MISSION", dashboardTitle: "MISSION CONTROL", dashboardSubtitle: "Select your destination. Complete missions sequentially to unlock deeper space.",
                missionPrefix: "MISSION", locked: "Clearance Required", startMission: "START MISSION", accessLog: "ACCESS LOG",
                backToMap: "Return to Star Map", practice: "Practice Simulation", complete: "Complete Mission",
                quizTitle: "SYSTEM CHECK", quizSubtitle: "Verify knowledge to update mission log.", verified: "CORRECT",
                verifiedMsg: "Excellent work, Cadet.", error: "INCORRECT", errorMsg: "Data mismatch. Review and retry.",
                retry: "Retry Question", nextMission: "Next Mission", close: "Close", systemAnalysis: "System Analysis",
                ranks: ["Rookie Cadet", "Star Voyager", "Stellar Engineer", "Galactic Pilot", "Cosmic Guardian"],
                rankUpTitle: "PROMOTION", rankUpSub: "NEW RANK ASSIGNED",
                nextQ: "Next Question", finishQ: "Complete Module", intel: "INTEL DATA"
            },
            hi: {
                navSubtitle: "à¤…à¤‚à¤¤à¤°à¤¿à¤•à¥à¤· à¤…à¤•à¤¾à¤¦à¤®à¥€", resetData: "à¤¡à¥‡à¤Ÿà¤¾ à¤°à¥€à¤¸à¥‡à¤Ÿ à¤•à¤°à¥‡à¤‚", currentRank: "à¤µà¤°à¥à¤¤à¤®à¤¾à¤¨ à¤°à¥ˆà¤‚à¤•",
                warpText: "à¤µà¤¾à¤°à¥à¤ª à¤¡à¥à¤°à¤¾à¤‡à¤µ à¤¶à¥à¤°à¥‚ à¤¹à¥‹ à¤°à¤¹à¤¾ à¤¹à¥ˆ...", landingTitle: "à¤¬à¥à¤°à¤¹à¥à¤®à¤¾à¤‚à¤¡ à¤•à¥€ à¤–à¥‹à¤œ",
                landingSubtitle: "à¤ªà¥ƒà¤¥à¥à¤µà¥€ à¤¸à¥‡ à¤¬à¥à¤°à¤¹à¥à¤®à¤¾à¤‚à¤¡ à¤•à¥‡ à¤•à¤¿à¤¨à¤¾à¤°à¥‡ à¤¤à¤• à¤•à¥€ à¤†à¤ªà¤•à¥€ à¤¯à¤¾à¤¤à¥à¤°à¤¾ à¤¯à¤¹à¤¾à¤ à¤¶à¥à¤°à¥‚ à¤¹à¥‹à¤¤à¥€ à¤¹à¥ˆà¥¤ à¤®à¤¿à¤¶à¤¨ à¤ªà¥‚à¤°à¥‡ à¤•à¤°à¥‡à¤‚, à¤¡à¥‡à¤Ÿà¤¾ à¤•à¤¾ à¤µà¤¿à¤¶à¥à¤²à¥‡à¤·à¤£ à¤•à¤°à¥‡à¤‚ à¤”à¤° à¤…à¤ªà¤¨à¥€ à¤°à¥ˆà¤‚à¤• à¤¬à¤¢à¤¼à¤¾à¤à¤‚à¥¤",
                startBtn: "à¤®à¤¿à¤¶à¤¨ à¤¶à¥à¤°à¥‚ à¤•à¤°à¥‡à¤‚", dashboardTitle: "à¤®à¤¿à¤¶à¤¨ à¤•à¤‚à¤Ÿà¥à¤°à¥‹à¤²", dashboardSubtitle: "à¤…à¤ªà¤¨à¤¾ à¤—à¤‚à¤¤à¤µà¥à¤¯ à¤šà¥à¤¨à¥‡à¤‚à¥¤ à¤—à¤¹à¤°à¥‡ à¤…à¤‚à¤¤à¤°à¤¿à¤•à¥à¤· à¤•à¥‹ à¤…à¤¨à¤²à¥‰à¤• à¤•à¤°à¤¨à¥‡ à¤•à¥‡ à¤²à¤¿à¤ à¤•à¥à¤°à¤®à¤¿à¤• à¤°à¥‚à¤ª à¤¸à¥‡ à¤®à¤¿à¤¶à¤¨ à¤ªà¥‚à¤°à¥‡ à¤•à¤°à¥‡à¤‚à¥¤",
                missionPrefix: "à¤®à¤¿à¤¶à¤¨", locked: "à¤…à¤¨à¥à¤®à¤¤à¤¿ à¤†à¤µà¤¶à¥à¤¯à¤• à¤¹à¥ˆ", startMission: "à¤®à¤¿à¤¶à¤¨ à¤¶à¥à¤°à¥‚ à¤•à¤°à¥‡à¤‚", accessLog: "à¤²à¥‰à¤— à¤¦à¥‡à¤–à¥‡à¤‚",
                backToMap: "à¤¸à¥à¤Ÿà¤¾à¤° à¤®à¥ˆà¤ª à¤ªà¤° à¤²à¥Œà¤Ÿà¥‡à¤‚", practice: "à¤…à¤­à¥à¤¯à¤¾à¤¸ à¤¸à¤¿à¤®à¥à¤²à¥‡à¤¶à¤¨", complete: "à¤®à¤¿à¤¶à¤¨ à¤ªà¥‚à¤°à¤¾ à¤•à¤°à¥‡à¤‚",
                quizTitle: "à¤¸à¤¿à¤¸à¥à¤Ÿà¤® à¤šà¥‡à¤•", quizSubtitle: "à¤®à¤¿à¤¶à¤¨ à¤²à¥‰à¤— à¤…à¤ªà¤¡à¥‡à¤Ÿ à¤•à¤°à¤¨à¥‡ à¤•à¥‡ à¤²à¤¿à¤ à¤œà¥à¤žà¤¾à¤¨ à¤•à¤¾ à¤¸à¤¤à¥à¤¯à¤¾à¤ªà¤¨ à¤•à¤°à¥‡à¤‚à¥¤", verified: "à¤¸à¤¹à¥€ à¤œà¤µà¤¾à¤¬",
                verifiedMsg: "à¤¬à¤¹à¥à¤¤ à¤¬à¤¢à¤¼à¤¿à¤¯à¤¾, à¤•à¥ˆà¤¡à¥‡à¤Ÿà¥¤", error: "à¤—à¤²à¤¤ à¤œà¤µà¤¾à¤¬", errorMsg: "à¤—à¤²à¤¤ à¤¡à¥‡à¤Ÿà¤¾à¥¤ à¤ªà¥à¤¨à¤ƒ à¤ªà¥à¤°à¤¯à¤¾à¤¸ à¤•à¤°à¥‡à¤‚à¥¤",
                retry: "à¤ªà¥à¤¨à¤ƒ à¤ªà¥à¤°à¤¯à¤¾à¤¸ à¤•à¤°à¥‡à¤‚", nextMission: "à¤…à¤—à¤²à¤¾ à¤®à¤¿à¤¶à¤¨", close: "à¤¬à¤‚à¤¦ à¤•à¤°à¥‡à¤‚", systemAnalysis: "à¤¸à¤¿à¤¸à¥à¤Ÿà¤® à¤µà¤¿à¤¶à¥à¤²à¥‡à¤·à¤£",
                ranks: ["à¤°à¤•à¥€ à¤•à¥ˆà¤¡à¥‡à¤Ÿ", "à¤¸à¥à¤Ÿà¤¾à¤° à¤µà¥‰à¤¯à¥‡à¤œà¤°", "à¤¸à¥à¤Ÿà¥‡à¤²à¤° à¤‡à¤‚à¤œà¥€à¤¨à¤¿à¤¯à¤°", "à¤—à¥‡à¤²à¥‡à¤•à¥à¤Ÿà¤¿à¤• à¤ªà¤¾à¤¯à¤²à¤Ÿ", "à¤•à¥‹à¤¸à¥à¤®à¤¿à¤• à¤—à¤¾à¤°à¥à¤œà¤¿à¤¯à¤¨"],
                rankUpTitle: "à¤ªà¤¦à¥‹à¤¨à¥à¤¨à¤¤à¤¿", rankUpSub: "à¤¨à¤ˆ à¤°à¥ˆà¤‚à¤• à¤®à¤¿à¤²à¥€",
                nextQ: "à¤…à¤—à¤²à¤¾ à¤ªà¥à¤°à¤¶à¥à¤¨", finishQ: "à¤®à¥‰à¤¡à¥à¤¯à¥‚à¤² à¤¸à¤®à¤¾à¤ªà¥à¤¤", intel: "à¤–à¥à¤«à¤¿à¤¯à¤¾ à¤¡à¥‡à¤Ÿà¤¾"
            }
        };

        const missionsData = {
            en: [
                {
                    id: 1, title: "The Solar Neighborhood", subtitle: "Planets & Moons", icon: "ph-planet", color: "cyan",
                    description: "Start your engines! We begin right here at home.",
                    content: { intro: "Our Solar System formed 4.6 billion years ago.", sections: [{ title: "Inner Planets", text: "Compact, rocky worlds.", cards: [{ name: "Mercury", detail: "Closest to Sun.", icon: "ph-circle", type: "Terrestrial", stats: { "Gravity": "3.7 m/sÂ²" } }, { name: "Earth", detail: "Our home.", icon: "ph-globe-hemisphere-west", type: "Terrestrial", stats: { "Gravity": "9.8 m/sÂ²" } }] }] },
                    quiz: [{ question: "Which planet is closest to the Sun?", options: ["Venus", "Mercury", "Mars", "Earth"], correct: 1, explanation: "Mercury is the innermost planet." }, { question: "Which planet is the Red Planet?", options: ["Mars", "Jupiter", "Saturn", "Venus"], correct: 0, explanation: "Mars is covered in iron oxide." }, { question: "Largest planet?", options: ["Earth", "Jupiter", "Saturn", "Neptune"], correct: 1, explanation: "Jupiter is the gas giant king." }, { question: "Planet with rings?", options: ["Mars", "Mercury", "Saturn", "Venus"], correct: 2, explanation: "Saturn has the most visible rings." }, { question: "Third rock from the sun?", options: ["Mars", "Earth", "Venus", "Mercury"], correct: 1, explanation: "Earth is the third planet." }]
                }
            ],
            hi: [
                {
                    id: 1, title: "à¤¸à¥Œà¤° à¤®à¤‚à¤¡à¤²", subtitle: "à¤—à¥à¤°à¤¹ à¤”à¤° à¤šà¤‚à¤¦à¥à¤°à¤®à¤¾", icon: "ph-planet", color: "cyan",
                    description: "à¤…à¤ªà¤¨à¥‡ à¤‡à¤‚à¤œà¤¨ à¤¶à¥à¤°à¥‚ à¤•à¤°à¥‡à¤‚! à¤¹à¤® à¤¯à¤¹à¥€à¤‚ à¤˜à¤° à¤¸à¥‡ à¤¶à¥à¤°à¥à¤†à¤¤ à¤•à¤°à¤¤à¥‡ à¤¹à¥ˆà¤‚à¥¤",
                    content: { intro: "à¤¹à¤®à¤¾à¤°à¤¾ à¤¸à¥Œà¤° à¤®à¤‚à¤¡à¤² 4.6 à¤…à¤°à¤¬ à¤¸à¤¾à¤² à¤ªà¤¹à¤²à¥‡ à¤¬à¤¨à¤¾ à¤¥à¤¾à¥¤", sections: [{ title: "à¤†à¤‚à¤¤à¤°à¤¿à¤• à¤—à¥à¤°à¤¹", text: "à¤šà¤Ÿà¥à¤Ÿà¤¾à¤¨à¥€ à¤¦à¥à¤¨à¤¿à¤¯à¤¾à¥¤", cards: [{ name: "à¤¬à¥à¤§", detail: "à¤¸à¥‚à¤°à¥à¤¯ à¤•à¥‡ à¤¸à¤¬à¤¸à¥‡ à¤•à¤°à¥€à¤¬à¥¤", icon: "ph-circle", type: "à¤¸à¥à¤¥à¤²à¥€à¤¯", stats: { "à¤—à¥à¤°à¥à¤¤à¥à¤µà¤¾à¤•à¤°à¥à¤·à¤£": "3.7 m/sÂ²" } }] }] },
                    quiz: [{ question: "à¤¸à¥‚à¤°à¥à¤¯ à¤•à¥‡ à¤¸à¤¬à¤¸à¥‡ à¤¨à¤¿à¤•à¤Ÿ à¤•à¥Œà¤¨ à¤¸à¤¾ à¤—à¥à¤°à¤¹ à¤¹à¥ˆ?", options: ["à¤¶à¥à¤•à¥à¤°", "à¤¬à¥à¤§", "à¤®à¤‚à¤—à¤²", "à¤ªà¥ƒà¤¥à¥à¤µà¥€"], correct: 1, explanation: "à¤¬à¥à¤§ à¤¸à¤¬à¤¸à¥‡ à¤›à¥‹à¤Ÿà¤¾ à¤”à¤° à¤¸à¤¬à¤¸à¥‡ à¤…à¤‚à¤¦à¤°à¥‚à¤¨à¥€ à¤—à¥à¤°à¤¹ à¤¹à¥ˆà¥¤" }, { question: "à¤²à¤¾à¤² à¤—à¥à¤°à¤¹ à¤•à¤¿à¤¸à¥‡ à¤•à¤¹à¤¤à¥‡ à¤¹à¥ˆà¤‚?", options: ["à¤®à¤‚à¤—à¤²", "à¤¬à¥ƒà¤¹à¤¸à¥à¤ªà¤¤à¤¿", "à¤¶à¤¨à¤¿", "à¤¶à¥à¤•à¥à¤°"], correct: 0, explanation: "à¤®à¤‚à¤—à¤² à¤—à¥à¤°à¤¹ à¤²à¤¾à¤² à¤¦à¤¿à¤–à¤¾à¤ˆ à¤¦à¥‡à¤¤à¤¾ à¤¹à¥ˆà¥¤" }, { question: "à¤¸à¤¬à¤¸à¥‡ à¤¬à¤¡à¤¼à¤¾ à¤—à¥à¤°à¤¹?", options: ["à¤ªà¥ƒà¤¥à¥à¤µà¥€", "à¤¬à¥ƒà¤¹à¤¸à¥à¤ªà¤¤à¤¿", "à¤¶à¤¨à¤¿", "à¤µà¤°à¥à¤£"], correct: 1, explanation: "à¤¬à¥ƒà¤¹à¤¸à¥à¤ªà¤¤à¤¿ à¤—à¥ˆà¤¸ à¤¦à¤¾à¤¨à¤µ à¤¹à¥ˆà¥¤" }, { question: "à¤›à¤²à¥à¤²à¥‡ à¤µà¤¾à¤²à¤¾ à¤—à¥à¤°à¤¹?", options: ["à¤®à¤‚à¤—à¤²", "à¤¬à¥à¤§", "à¤¶à¤¨à¤¿", "à¤¶à¥à¤•à¥à¤°"], correct: 2, explanation: "à¤¶à¤¨à¤¿ à¤•à¥‡ à¤›à¤²à¥à¤²à¥‡ à¤ªà¥à¤°à¤¸à¤¿à¤¦à¥à¤§ à¤¹à¥ˆà¤‚à¥¤" }, { question: "à¤¸à¥‚à¤°à¥à¤¯ à¤¸à¥‡ à¤¤à¥€à¤¸à¤°à¤¾ à¤—à¥à¤°à¤¹?", options: ["à¤®à¤‚à¤—à¤²", "à¤ªà¥ƒà¤¥à¥à¤µà¥€", "à¤¶à¥à¤•à¥à¤°", "à¤¬à¥à¤§"], correct: 1, explanation: "à¤ªà¥ƒà¤¥à¥à¤µà¥€ à¤¤à¥€à¤¸à¤°à¤¾ à¤—à¥à¤°à¤¹ à¤¹à¥ˆà¥¤" }]
                }
            ]
        };

        // --- 3. MAIN APP LOGIC ---
        const app = {
            state: { currentView: 'intro', unlockedMissions: 1, rank: 0, lang: 'en', activeQuiz: null },
            rankColors: [
                { border: 'border-slate-500', text: 'text-slate-400', shadow: 'shadow-none', glow: 'bg-slate-500' },
                { border: 'border-cyan-400', text: 'text-cyan-400', shadow: 'shadow-[0_0_15px_rgba(34,211,238,0.5)]', glow: 'bg-cyan-400' },
                { border: 'border-blue-500', text: 'text-blue-400', shadow: 'shadow-[0_0_20px_rgba(59,130,246,0.6)]', glow: 'bg-blue-500' },
                { border: 'border-yellow-400', text: 'text-yellow-400', shadow: 'shadow-[0_0_25px_rgba(250,204,21,0.6)]', glow: 'bg-yellow-400' },
                { border: 'border-purple-500', text: 'text-purple-400', shadow: 'shadow-[0_0_30px_rgba(168,85,247,0.7)]', glow: 'bg-purple-500' }
            ],

            init: () => {
                app.loadProgress();
                app.updateUI();
                starSystem.init();
                starSystem.animate();
                app.initCursor();
            },

            initCursor: () => {
                const dot = document.getElementById('cursor-dot'); const ring = document.getElementById('cursor-ring');
                window.addEventListener('mousemove', (e) => { dot.style.left = e.clientX + 'px'; dot.style.top = e.clientY + 'px'; setTimeout(() => { ring.style.left = e.clientX + 'px'; ring.style.top = e.clientY + 'px'; }, 50); });
                document.addEventListener('mouseover', (e) => { if (e.target.tagName === 'BUTTON' || e.target.classList.contains('cursor-pointer') || e.target.closest('button')) document.body.classList.add('hovering'); else document.body.classList.remove('hovering'); });
            },
            toggleLanguage: () => {
                app.state.lang = app.state.lang === 'en' ? 'hi' : 'en';
                document.getElementById('btn-en').classList.toggle('active'); document.getElementById('btn-hi').classList.toggle('active');
                if (app.state.lang === 'hi') { document.body.classList.add('lang-hi'); document.body.classList.remove('lang-en'); } else { document.body.classList.add('lang-en'); document.body.classList.remove('lang-hi'); }
                app.updateUI(); if (app.state.currentView === 'dashboard') app.renderDashboard(); if (app.state.currentView === 'mission-detail') app.showDashboard();
            },
            updateUI: () => {
                const t = i18n[app.state.lang];
                document.getElementById('nav-subtitle').innerText = t.navSubtitle; document.getElementById('btn-reset').innerText = t.resetData;
                document.getElementById('label-rank').innerText = t.currentRank; document.getElementById('warp-text').innerText = t.warpText;
                document.getElementById('landing-title').innerText = t.landingTitle; document.getElementById('landing-subtitle').innerText = t.landingSubtitle;
                document.getElementById('btn-start').querySelector('span').innerText = t.startBtn; document.getElementById('dashboard-title').innerText = t.dashboardTitle;
                document.getElementById('dashboard-subtitle').innerText = t.dashboardSubtitle; document.getElementById('btn-back').childNodes[2].nodeValue = " " + t.backToMap;
                document.getElementById('quiz-title').innerText = t.quizTitle; document.getElementById('quiz-subtitle').innerText = t.quizSubtitle;
                document.getElementById('rank-modal-subtitle').innerText = t.rankUpSub; document.querySelector('#rank-modal h2').innerText = t.rankUpTitle;
                app.updateRankVisuals();
            },
            saveProgress: () => localStorage.setItem('starCadetProgress', JSON.stringify({ unlocked: app.state.unlockedMissions, rankIndex: app.state.rank, lang: app.state.lang })),
            loadProgress: () => { const saved = localStorage.getItem('starCadetProgress'); if (saved) { const data = JSON.parse(saved); app.state.unlockedMissions = data.unlocked; app.state.rank = data.rankIndex || 0; } },
            resetProgress: () => { if (confirm("Reset Data?")) { localStorage.removeItem('starCadetProgress'); app.state.unlockedMissions = 1; app.state.rank = 0; app.updateRankVisuals(); app.showDashboard(); } },
            goHome: () => app.switchView('intro'),
            startJourney: () => app.animateWarp(() => app.showDashboard()),
            showDashboard: () => { app.renderDashboard(); app.switchView('dashboard'); },
            launchHoloDeck: () => { app.animateWarp(() => { document.querySelectorAll('section').forEach(el => el.classList.add('hidden-section')); const holo = document.getElementById('solar-system-view'); holo.classList.remove('hidden-section'); solarApp.init(); }); },
            closeHoloDeck: () => { app.switchView('intro'); },
            animateWarp: (callback) => {
                const warp = document.getElementById('warp-overlay');
                warp.classList.add('active');
                if (typeof starSystem !== 'undefined' && starSystem.speedMultiplier) {
                    starSystem.speedMultiplier = 60;
                }
                setTimeout(() => {
                    callback();
                    setTimeout(() => {
                        if (typeof starSystem !== 'undefined' && starSystem.speedMultiplier) {
                            starSystem.speedMultiplier = 1;
                        }
                        warp.classList.remove('active');
                    }, 800);
                }, 1500);
            },
            switchView: (viewName) => { app.state.currentView = viewName; document.querySelectorAll('section').forEach(el => el.classList.add('hidden-section')); const target = document.getElementById(`${viewName}-view`); target.classList.remove('hidden-section'); target.classList.remove('fade-enter-active'); void target.offsetWidth; target.classList.add('fade-enter-active'); window.scrollTo(0, 0); },
            unlockNextMission: (currentId) => { const missions = missionsData[app.state.lang]; if (currentId === app.state.unlockedMissions) { const oldRank = app.state.rank; const t = i18n[app.state.lang]; app.state.unlockedMissions++; const newRankIndex = Math.min(app.state.unlockedMissions - 1, t.ranks.length - 1); app.state.rank = newRankIndex; app.saveProgress(); if (newRankIndex > oldRank) { app.showRankUpModal(t.ranks[newRankIndex]); } else { app.updateRankVisuals(); } } app.closeQuiz(); app.showDashboard(); },
            showRankUpModal: (rankName) => { const modal = document.getElementById('rank-modal'); document.getElementById('new-rank-name').innerText = rankName; modal.classList.remove('hidden'); app.updateRankVisuals(); },
            closeRankModal: () => document.getElementById('rank-modal').classList.add('hidden'),
            updateRankVisuals: () => { const t = i18n[app.state.lang]; const rankName = t.ranks[app.state.rank]; document.getElementById('rank-display').innerText = rankName; const style = app.rankColors[app.state.rank] || app.rankColors[0]; document.getElementById('rank-display').className = `font-bold font-mono transition-colors duration-500 ${style.text}`; document.getElementById('profile-container').className = `w-12 h-12 rounded-full bg-slate-800 border-2 flex items-center justify-center relative overflow-hidden transition-all duration-500 ${style.border} ${style.shadow}`; document.getElementById('profile-glow').className = `absolute inset-0 opacity-50 blur-md transition-colors duration-500 ${style.glow}`; },
            renderDashboard: () => { const list = document.getElementById('mission-list'); list.innerHTML = ''; const t = i18n[app.state.lang]; const missions = missionsData[app.state.lang]; missions.forEach((mission, index) => { const isUnlocked = mission.id <= app.state.unlockedMissions; const isCompleted = mission.id < app.state.unlockedMissions; const alignClass = index % 2 === 0 ? 'md:flex-row' : 'md:flex-row-reverse'; const margin = index % 2 === 0 ? 'md:pr-12' : 'md:pl-12'; const unlockedClass = isUnlocked ? 'opacity-100' : 'opacity-50 grayscale'; const borderClass = isUnlocked ? `border-${mission.color}-500` : 'border-slate-700'; const safeColor = mission.color === 'neon-gold' ? 'yellow' : mission.color; const delay = (index + 1) * 150; let button = isUnlocked ? `<button onclick="app.loadMission(${mission.id})" class="mt-4 px-6 py-2 bg-${safeColor}-500/10 border border-${safeColor}-500 text-${safeColor}-400 clip-corners hover:bg-${safeColor}-500 hover:text-white transition-all text-sm font-bold uppercase tracking-wider shadow-[0_0_10px_rgba(0,0,0,0)] hover:shadow-[0_0_15px_currentColor]">${isCompleted ? t.accessLog : t.startMission}</button>` : `<div class="mt-4 flex items-center gap-2 text-xs text-red-400 font-mono uppercase tracking-widest"><i class="ph-bold ph-lock-key"></i> ${t.locked}</div>`; list.innerHTML += `<div class="flex flex-col ${alignClass} items-center w-full relative group stagger-item" style="animation-delay: ${delay}ms"><div class="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-4 h-4 rounded-full ${isUnlocked ? `bg-${safeColor}-500 shadow-[0_0_15px_var(--neon-${safeColor})]` : 'bg-slate-700'} z-10 hidden md:block border-2 border-slate-900 transition-all"></div><div class="w-full md:w-5/12 ${margin} mb-8 md:mb-0 relative z-20"><div class="glass-panel p-6 border-l-4 ${borderClass} ${unlockedClass} hover:scale-[1.02] transition-transform duration-300 clip-corners"><div class="flex justify-between items-start mb-2"><div class="inline-flex items-center justify-center w-10 h-10 bg-slate-800 text-${safeColor}-400 mb-3 border border-white/10"><i class="${mission.icon} text-xl"></i></div>${isCompleted ? '<i class="ph-fill ph-check-circle text-green-400 text-2xl drop-shadow-[0_0_5px_rgba(74,222,128,0.8)]"></i>' : ''}</div><h3 class="text-2xl font-bold text-white mb-1 orbitron">${t.missionPrefix} 0${mission.id}</h3><h4 class="text-lg text-${safeColor}-400 font-semibold mb-2 font-mono">${mission.title}</h4><p class="text-sm text-gray-400 leading-relaxed mb-4">${mission.description}</p>${button}</div></div></div>`; }); },
            loadMission: (id) => { app.animateWarp(() => { const missions = missionsData[app.state.lang]; const mission = missions.find(m => m.id === id); const container = document.getElementById('mission-content-area'); const t = i18n[app.state.lang]; const safeColor = mission.color === 'neon-gold' ? 'yellow' : mission.color; let contentHTML = `<div class="relative glass-panel overflow-hidden mb-8 shadow-[0_0_30px_rgba(0,0,0,0.5)] border-t border-${safeColor}-500 stagger-item" style="animation-delay: 100ms"><div class="p-8 md:p-12 relative"><div class="absolute top-0 right-0 p-4 opacity-10"><i class="${mission.icon} text-9xl text-white"></i></div><div class="flex items-center gap-4 mb-6 relative z-10"><i class="${mission.icon} text-4xl text-${safeColor}-400 animate-pulse"></i><div><h2 class="text-4xl md:text-5xl font-black text-white orbitron" id="mission-title-anim">${mission.title.toUpperCase()}</h2><p class="text-xl text-${safeColor}-300 font-light tracking-wide font-mono">${mission.subtitle}</p></div></div><p class="text-lg md:text-xl text-gray-300 border-l-2 border-${safeColor}-500/50 pl-4 italic max-w-3xl relative z-10">${mission.content.intro}</p></div></div>`; mission.content.sections.forEach((section, sIdx) => { const delay = (sIdx + 2) * 150; contentHTML += `<div class="mb-12 stagger-item" style="animation-delay: ${delay}ms"><h3 class="text-2xl font-bold text-white mb-4 flex items-center gap-3"><span class="w-8 h-1 bg-${safeColor}-500 rounded-full box-shadow-glow"></span>${section.title}</h3><p class="text-gray-300 mb-6 text-lg pl-11">${section.text}</p><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 pl-0 md:pl-11">${section.cards.map((card, cIdx) => `<div onclick="app.showDetail(${id}, ${sIdx}, ${cIdx})" class="cursor-pointer bg-slate-800/40 border border-white/5 p-5 hover:bg-slate-800/80 hover:border-${safeColor}-500/50 transition-all group relative overflow-hidden clip-corners"><div class="absolute top-0 right-0 p-2 opacity-0 group-hover:opacity-100 transition-opacity"><i class="ph-bold ph-info text-${safeColor}-400"></i></div><i class="${card.icon} text-3xl text-${safeColor}-400 mb-3 group-hover:scale-110 transition-transform block drop-shadow-md"></i><h4 class="font-bold text-white mb-1 group-hover:text-${safeColor}-300 transition-colors font-mono">${card.name}</h4><p class="text-xs text-gray-400 leading-relaxed">${card.detail}</p></div>`).join('')}</div></div>`; }); const isCompleted = app.state.unlockedMissions > id; contentHTML += `<div class="mt-16 text-center py-12 border-t border-white/10 stagger-item" style="animation-delay: 800ms"><button onclick="app.openQuiz(${id})" class="px-10 py-4 bg-gradient-to-r from-${safeColor}-600 to-${safeColor}-400 text-black font-bold clip-corners shadow-lg shadow-${safeColor}-500/30 hover:shadow-${safeColor}-500/50 hover:scale-105 transition-all text-lg flex items-center gap-2 mx-auto"><i class="ph-bold ph-check-square"></i> ${isCompleted ? t.practice : t.complete}</button></div>`; container.innerHTML = contentHTML; app.switchView('mission-detail'); const titleEl = document.getElementById('mission-title-anim'); if (titleEl && app.state.lang === 'en') app.scrambleText(titleEl, mission.title.toUpperCase()); }); },
            showDetail: (mId, sId, cId) => { const missions = missionsData[app.state.lang]; const mission = missions.find(m => m.id === mId); const item = mission.content.sections[sId].cards[cId]; const modal = document.getElementById('detail-modal'); const content = document.getElementById('detail-content'); const safeColor = mission.color === 'neon-gold' ? 'yellow' : mission.color; const t = i18n[app.state.lang]; let statsHTML = ''; for (const [key, value] of Object.entries(item.stats)) { statsHTML += `<div class="bg-black/40 p-3 border-l-2 border-${safeColor}-500"><div class="text-xs text-gray-500 uppercase tracking-wider font-bold">${key}</div><div class="text-white font-mono text-lg text-${safeColor}-300">${value}</div></div>`; } content.innerHTML = `<div class="md:w-1/3 bg-slate-900/80 p-8 flex items-center justify-center border-b md:border-b-0 md:border-r border-white/10 relative overflow-hidden"><div class="absolute inset-0 bg-${safeColor}-500/5 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-30"></div><i class="${item.icon} text-9xl text-${safeColor}-400 relative z-10 animate-float drop-shadow-[0_0_30px_rgba(255,255,255,0.2)]"></i></div><div class="md:w-2/3 p-8 relative"><div class="absolute top-4 right-4 flex gap-1"><div class="w-12 h-1 bg-${safeColor}-500/50"></div><div class="w-2 h-1 bg-${safeColor}-500/50"></div></div><div class="flex justify-between items-start mb-4"><div><h3 class="text-4xl font-bold text-white orbitron tracking-wide" id="detail-title">${item.name}</h3><span class="px-2 py-1 bg-${safeColor}-500/20 text-${safeColor}-300 text-xs border border-${safeColor}-500/50 uppercase font-bold tracking-widest mt-2 inline-block">${item.type}</span></div></div><p class="text-gray-300 text-lg mb-8 leading-relaxed">${item.detail}</p><h4 class="text-sm font-bold text-gray-400 uppercase mb-4 border-b border-gray-700 pb-2">${t.systemAnalysis}</h4><div class="grid grid-cols-2 gap-4">${statsHTML}</div></div>`; modal.classList.remove('hidden'); if (app.state.lang === 'en') app.scrambleText(document.getElementById('detail-title'), item.name); },
            closeDetail: () => document.getElementById('detail-modal').classList.add('hidden'),
            openQuiz: (missionId) => { const missions = missionsData[app.state.lang]; const mission = missions.find(m => m.id === missionId); const modal = document.getElementById('quiz-modal'); app.state.activeQuiz = { missionId: missionId, currentQuestion: 0, score: 0 }; document.getElementById('quiz-feedback').classList.add('hidden'); modal.classList.remove('hidden'); app.renderQuizQuestion(); },
            renderQuizQuestion: () => { const { missionId, currentQuestion } = app.state.activeQuiz; const missions = missionsData[app.state.lang]; const mission = missions.find(m => m.id === missionId); const questionData = mission.quiz[currentQuestion]; const container = document.getElementById('quiz-question-container'); const feedback = document.getElementById('quiz-feedback'); const progressEl = document.getElementById('quiz-progress'); progressEl.style.width = `${(currentQuestion / mission.quiz.length) * 100}%`; feedback.classList.add('hidden'); let optionsHTML = ''; questionData.options.forEach((opt, idx) => { optionsHTML += `<button onclick="app.checkAnswer(${idx}, this)" class="w-full text-left p-4 bg-slate-800/50 hover:bg-slate-700 border border-slate-600 mb-3 transition-all flex items-center justify-between group clip-corners"><span class="text-gray-200 group-hover:text-white font-mono text-lg">${opt}</span><div class="w-5 h-5 border border-slate-500 group-hover:border-cyan-400 transition-colors bg-black"></div></button>`; }); container.innerHTML = `<div class="flex justify-between items-center mb-4 text-xs text-cyan-400 font-mono tracking-widest"><span>QUESTION ${currentQuestion + 1} / ${mission.quiz.length}</span><span>MISSION ${missionId}</span></div><p class="text-xl font-medium text-white mb-8 leading-relaxed animate-fade-in">${questionData.question}</p><div class="space-y-3">${optionsHTML}</div>`; },
            checkAnswer: (selectedIdx, btnElement) => { const { missionId, currentQuestion } = app.state.activeQuiz; const missions = missionsData[app.state.lang]; const mission = missions.find(m => m.id === missionId); const questionData = mission.quiz[currentQuestion]; const isCorrect = selectedIdx === questionData.correct; const feedback = document.getElementById('quiz-feedback'); const t = i18n[app.state.lang]; document.getElementById('quiz-question-container').querySelectorAll('button').forEach(btn => { btn.disabled = true; btn.classList.add('opacity-50'); }); btnElement.classList.remove('opacity-50'); if (isCorrect) { btnElement.classList.remove('bg-slate-800/50', 'border-slate-600'); btnElement.classList.add('bg-green-500/20', 'border-green-500'); btnElement.querySelector('div').classList.add('bg-green-500'); const isLastQuestion = currentQuestion === mission.quiz.length - 1; const isNewUnlock = app.state.unlockedMissions === missionId && isLastQuestion; const intelHTML = `<div class="mt-2 mb-4 p-3 bg-cyan-900/20 border-l-2 border-cyan-400 text-left text-sm text-cyan-100"><strong class="block text-xs uppercase tracking-widest text-cyan-400 mb-1">${t.intel}</strong>${questionData.explanation}</div>`; let actionButton = isLastQuestion ? (isNewUnlock ? `<button onclick="app.unlockNextMission(${missionId})" class="w-full px-8 py-3 bg-green-500 text-black font-bold clip-corners hover:bg-green-400 hover:scale-105 transition-all shadow-lg shadow-green-900/50 mt-2">${t.nextMission}</button>` : `<button onclick="app.closeQuiz()" class="w-full px-6 py-3 bg-gray-600 text-white font-bold clip-corners hover:bg-gray-500 mt-2">${t.close}</button>`) : `<button onclick="app.nextQuestion()" class="w-full px-8 py-3 bg-cyan-500 text-black font-bold clip-corners hover:bg-cyan-400 mt-2">${t.nextQ}</button>`; feedback.innerHTML = `<div class="text-green-400 font-bold text-xl mb-2 flex items-center justify-center gap-2 orbitron"><i class="ph-fill ph-check-circle"></i> ${t.verified}</div>${intelHTML}${actionButton}`; } else { btnElement.classList.remove('bg-slate-800/50', 'border-slate-600'); btnElement.classList.add('bg-red-500/20', 'border-red-500'); feedback.innerHTML = `<div class="text-red-400 font-bold text-xl mb-2 flex items-center justify-center gap-2 orbitron"><i class="ph-fill ph-warning-circle"></i> ${t.error}</div><p class="text-sm text-gray-300 mb-4">${t.errorMsg}</p><button onclick="app.renderQuizQuestion()" class="w-full px-6 py-2 bg-red-500/20 text-red-300 border border-red-500 clip-corners hover:bg-red-500 hover:text-white transition-all">${t.retry}</button>`; } feedback.classList.remove('hidden'); },
            nextQuestion: () => { app.state.activeQuiz.currentQuestion++; app.renderQuizQuestion(); },
            scrambleText: (element, finalValue) => { let i = 0; const inv = setInterval(() => { element.innerText = finalValue.split("").map((c, idx) => idx < i ? finalValue[idx] : "ABCDEF0123456789"[Math.floor(Math.random() * 16)]).join(""); if (i >= finalValue.length) clearInterval(inv); i += 1 / 3; }, 30); },
            closeQuiz: () => document.getElementById('quiz-modal').classList.add('hidden')
        };

        window.addEventListener('resize', starSystem.init);
        app.init(); 
    </script>
</body>

</html>